<div class="p-6">

  <!-- Toggle Navigation -->
  <div class="w-fit flex gap-4 p-2 mb-6 bg-white/50 rounded-xl border border-amber-50 shadow-sm">
    <button id="btnGroups" class="px-4 py-2 rounded-md text-gray-900 hover:bg-blue-600">Salary Groups</button>
    <button id="btnScales" class="px-4 py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600">Salary Scale</button>
  </div>

  <!-- Salary Groups -->
  <div id="groupSection">
    <div class="flex justify-between mb-4">
      <h2 class="text-xl lg:text-2xl text-blue-600 font-bold">Salary Groups</h2>
      <button id="addNewGroupBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add New Group</button>
    </div>

    <form id="groupForm" class="hidden grid grid-cols-2 gap-4">
      <label>Group Code</label>
      <input type="text" id="groupCode" class="border p-2 rounded">
      <label>Description</label>
      <input type="text" id="groupDesc" class="border p-2 rounded">
      <label>Effective Date</label>
      <input type="date" id="groupEff" class="border p-2 rounded">
      <label>Last Date</label>
      <input type="date" id="groupLast" class="border p-2 rounded">
      <div class="col-span-2 flex justify-end gap-2">
        <button type="button" id="saveGroupBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Save</button>
        <button type="button" id="cancelGroupBtn" class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Cancel</button>
      </div>
    </form>

    <div class="mt-6 overflow-x-auto">
      <table class="min-w-full border border-gray-200 rounded-lg text-sm">
        <thead class="bg-blue-100 text-blue-900">
          <tr>
            <th class="border px-2 py-3 text-left">Code</th>
            <th class="border px-2 py-3 text-left">Description</th>
            <th class="border px-2 py-3 text-left">Effective Date</th>
            <th class="border px-2 py-3 text-left">Last Date</th>
            <th class="border px-2 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody id="groupTable">

        </tbody>
      </table>
    </div>
  </div>

  <!-- Salary Scales -->
  <div id="scaleSection" class="hidden">
    <div class="flex justify-between mb-4">
      <div>
        <h2 class="text-xl lg:text-2xl text-blue-600 font-bold">Salary Scale</h2>
      </div>
      <div>
        <button id="addNewScaleBtn" type="button"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          + Add New Scale
        </button>
        <button id="tabBatchBtn" type="button"
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
          Batch Upload
        </button>
        <button id="generateReportsBtn" type="button"
          class="bg-yellow-600 text-white px-4 py-2 rounded hover:bg-yellow-700">
          Generate Reports
        </button>
      </div>
    </div>

    <!-- Add New Scale Form -->
    <form id="scaleForm"
          class="hidden grid grid-cols-2 gap-4 p-4">
      <label>Salary Group</label>
      <select id="scaleGroup" class="border p-2 rounded">
        <option value="">Select Group</option>
      </select>
      <label>Element Type</label>
      <select id="scaleElement" class="border p-2 rounded">
        <option value="">Select Element</option>
      </select>
      <label>Grade Level</label>
      <select id="scaleGrade" class="border p-2 rounded">
        <option value="">Select Grade</option>
      </select>

      <div id="stepFields"
          class="col-span-2 grid grid-cols-4 gap-2 mt-4 hidden"></div>

      <div class="col-span-2 flex justify-end mt-6 gap-2">
        <button type="submit"
          class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
          Save
        </button>
        <button type="button" id="cancelScaleBtn"
          class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">
          Cancel
        </button>
      </div>
    </form>

    <!-- Batch Upload Form -->
    <div class="flex justify-end">
    <form id="batchUploadForm"
          class="hidden w-full max-w-lg rounded-2xl pt-6 p-2">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File</label>
        <input type="file" id="batchFile"
          class="mt-1 block w-full border border-blue-500 bg-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"/>
        <p class="text-xs text-gray-500 mt-2">
          Only .xlsx or .csv files allowed.
          <a href="sample.csv" download
            class="text-blue-600 hover:underline ml-2">Download Sample</a>
        </p>
      </div>

      <div class="flex justify-end space-x-4 mt-4">
        <button type="button" id="uploadBatchBtn"
          class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded text-white">
          Upload
        </button>

        <button type="button" id="cancelBatchBtn"
          class="px-6 py-2 bg-gray-400 hover:bg-gray-500 rounded text-white">
          Cancel
        </button>
      </div>
    </form>
  </div>

    <!-- Table -->
    <div class="mt-6 overflow-x-auto">
      <table class="min-w-full border border-gray-200 rounded-lg text-sm">
        <thead class="bg-blue-100 text-blue-900">
          <tr>
            <th class="border px-2 py-3 text-left">Salary Code</th>
            <th class="border px-2 py-3 text-left">Paycode</th>
            <th class="border px-2 py-3 text-left">Grade</th>
            <th class="border px-2 py-3 text-left">Actions</th>
          </tr>
        </thead>
        <tbody id="scaleTable"></tbody>
      </table>
    </div>
  </div>
</div>

<!-- View Modal -->
<div id="scaleViewModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-gradient-to-br from-blue-50 to-yellow-50 p-6 rounded-2xl shadow-2xl w-full max-w-3xl mx-4 max-h-[90vh] overflow-y-auto border border-blue-100">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-3">
      <h3 class="text-xl font-bold text-blue-700 flex items-center gap-2">
        Scale Details
      </h3>
      <button id="closeScaleView" class="text-gray-400 hover:text-gray-600 transition transform hover:scale-110">
        âœ–
      </button>
    </div>

    <!-- Content -->
    <div id="scaleViewContent" class="space-y-6"></div>
  </div>
</div>

<script>
  // Simulated Data
  let groups = [
    {id:1, groupcode:"NAVY01", grpdesc:"NAVY PAY", effdate:"2025-01-01", lastdate:"2025-12-31"},
    {id:2, groupcode:"DEFP02", grpdesc:"DEFENCE PAY", effdate:"2025-01-01", lastdate:"2025-12-31"}
  ];
  let elements = [
    {id:1, code:"BP301", desc:"Pension Addition"},
    {id:2, code:"BP302", desc:"Pension Deduction"}
  ];
  let grades = [
    {id:1, code:"01", desc:"Level 1"},
    {id:2, code:"02", desc:"Level 2"}
  ];
  let scales = [
    {group:"NAVY01", element:"BP301", grade:"01", steps:["1000","1100","1200","","","","","","","","","","","","","","","","","15"]},
    {group:"DEFP02", element:"BP302", grade:"02", steps:["2000","2100","2200","","","","","","","","","","","","","","","","","10"]}
  ];
  let editingScaleIndex = null;
  let editingGroupIndex = null;

  // Generate step fields dynamically
  function generateStepFields() {
    const stepFieldsContainer = document.getElementById("stepFields");
    let stepHTML = '';
    for(let i = 1; i <= 20; i++) {
      stepHTML += `
        <div>
          <label class="block text-sm font-medium">Step ${i}</label>
          <input type="text" id="step${i}" class="border p-2 rounded w-full">
        </div>`;
    }
    stepFieldsContainer.innerHTML = stepHTML;
  }

  // Define all functions at the top level
  window.viewScale = function(index) {
    const s = scales[index];
    let html = `
      <div class="p-6 border rounded-2xl shadow-lg bg-gradient-to-br from-blue-50 to-white">
        <div class="mb-4">
          <p class="text-lg font-semibold text-gray-800">
            <span class="text-blue-600">Salary Code:</span> ${s.group}
          </p>
          <p class="text-lg font-semibold text-gray-800">
            <span class="text-blue-600">Paycode:</span> ${s.element}
          </p>
          <p class="text-lg font-semibold text-gray-800">
            <span class="text-blue-600">Grade:</span> ${s.grade}
          </p>
        </div>

        <div class="grid grid-cols-5 gap-3 mt-6">
    `;

    for (let i = 0; i < 20; i++) {
      html += `
        <div class="p-3 rounded-xl border border-gray-200 shadow-sm bg-white hover:shadow-md transition">
          <p class="text-sm font-medium text-gray-600">Step ${i+1}</p>
          <p class="text-base font-semibold text-gray-900">${s.steps[i] || "-"}</p>
        </div>`;
    }

    html += `
        </div>
      </div>
    `;

    document.getElementById("scaleViewContent").innerHTML = html;
    document.getElementById("scaleViewModal").classList.remove("hidden");
  };

  window.editScale = function(index) {
    const s = scales[index];
    document.getElementById("scaleGroup").value = s.group;
    document.getElementById("scaleElement").value = s.element;
    document.getElementById("scaleGrade").value = s.grade;
    
    // Populate step values
    for(let i = 0; i < 20; i++) {
      document.getElementById("step" + (i+1)).value = s.steps[i] || "";
    }
    
    editingScaleIndex = index;
    document.getElementById("stepFields").classList.remove("hidden");
    document.getElementById("scaleForm").classList.remove("hidden");
    showSection("scaleSection","btnScales");
  };

  window.deleteScale = function(index) {
    if(confirm("Delete this scale?")) {
      scales.splice(index, 1);
      renderScaleTable();
    }
  };

  window.editGroup = function(index) {
    const g = groups[index];
    document.getElementById("groupCode").value = g.groupcode;
    document.getElementById("groupDesc").value = g.grpdesc;
    document.getElementById("groupEff").value = g.effdate;
    document.getElementById("groupLast").value = g.lastdate;
    
    editingGroupIndex = index;
    document.getElementById("groupForm").classList.remove("hidden");
  };

  // Initialize step fields on page load
  generateStepFields();

  // GROUP form show/hide
  document.getElementById("addNewGroupBtn").addEventListener("click", () => {
    document.getElementById("groupForm").classList.remove("hidden");
  });
  
    document.getElementById("cancelGroupBtn").addEventListener("click", () => {
    document.getElementById("groupForm").classList.add("hidden");
    document.getElementById("groupForm").reset();
    editingGroupIndex = null;
  });

  const scaleForm = document.getElementById("scaleForm");
  const batchForm = document.getElementById("batchUploadForm");

  // Add New Scale toggle
  document.getElementById("addNewScaleBtn").addEventListener("click", () => {
    // hide batch form
    batchForm.classList.add("hidden");
    // toggle scale form
    scaleForm.classList.toggle("hidden");
  });

  // Batch Upload toggle
  document.getElementById("tabBatchBtn").addEventListener("click", () => {
    // hide scale form
    scaleForm.classList.add("hidden");
    // toggle batch form
    batchForm.classList.toggle("hidden");
  });

// Cancel buttons
document.getElementById("cancelScaleBtn").addEventListener("click", () => {
  scaleForm.classList.add("hidden");
  document.getElementById("stepFields").classList.add("hidden");
});

document.getElementById("cancelBatchBtn").addEventListener("click", () => {
  batchForm.classList.add("hidden");
});
  
  document.getElementById("cancelScaleBtn").addEventListener("click", () => {
    document.getElementById("scaleForm").classList.add("hidden");
    document.getElementById("stepFields").classList.add("hidden");
    document.getElementById("scaleForm").reset();
    editingScaleIndex = null;
  });

  // Toggle Section
  function showSection(sectionId, btnId) {
    ["groupSection","scaleSection"].forEach(id => {
      document.getElementById(id).classList.add("hidden");
    });
    ["btnGroups","btnScales"].forEach(id => {
      document.getElementById(id).classList.remove("bg-blue-600","text-white");
      document.getElementById(id).classList.add("bg-yellow-400","text-gray-900");
    });
    document.getElementById(sectionId).classList.remove("hidden");
    const btn = document.getElementById(btnId);
    btn.classList.remove("bg-yellow-400","text-gray-900");
    btn.classList.add("bg-blue-600","text-white");
  }

  document.getElementById("btnGroups").addEventListener("click", () => showSection("groupSection","btnGroups"));
  document.getElementById("btnScales").addEventListener("click", () => showSection("scaleSection","btnScales"));
  
  // Initialize with groups section visible
  showSection("groupSection","btnGroups");

  // Populate dropdowns
  function loadDropdowns() {
    const gSel = document.getElementById("scaleGroup");
    const eSel = document.getElementById("scaleElement");
    const grSel = document.getElementById("scaleGrade");
    
    gSel.innerHTML = '<option value="">Select Group</option>' + 
      groups.map(g => `<option value="${g.groupcode}">${g.grpdesc}</option>`).join("");
    eSel.innerHTML = '<option value="">Select Element</option>' + 
      elements.map(e => `<option value="${e.code}">${e.desc}</option>`).join("");
    grSel.innerHTML = '<option value="">Select Grade</option>' + 
      grades.map(gr => `<option value="${gr.code}">${gr.desc}</option>`).join("");
  }

  // Show step fields when all 3 dropdowns selected
  function checkDropdownSelections() {
    const g = document.getElementById("scaleGroup").value;
    const e = document.getElementById("scaleElement").value;
    const gr = document.getElementById("scaleGrade").value;
    
    if(g && e && gr) {
      document.getElementById("stepFields").classList.remove("hidden");
    } else {
      document.getElementById("stepFields").classList.add("hidden");
    }
  }

  ["scaleGroup","scaleElement","scaleGrade"].forEach(id => {
    document.getElementById(id).addEventListener("change", checkDropdownSelections);
  });

  // Save Group
  document.getElementById("saveGroupBtn").addEventListener("click", () => {
    const newGroup = {
      id: groups.length + 1,
      groupcode: document.getElementById("groupCode").value,
      grpdesc: document.getElementById("groupDesc").value,
      effdate: document.getElementById("groupEff").value,
      lastdate: document.getElementById("groupLast").value
    };
    
    if(newGroup.groupcode && newGroup.grpdesc) {
      if(editingGroupIndex !== null) {
        // Update existing group
        groups[editingGroupIndex] = newGroup;
        editingGroupIndex = null;
      } else {
        // Add new group
        groups.push(newGroup);
      }
      renderGroupTable();
      loadDropdowns(); // Refresh dropdowns
      document.getElementById("groupForm").reset();
      document.getElementById("groupForm").classList.add("hidden");
    } else {
      alert("Please fill in all required fields");
    }
  });

  // Save Scale
  document.getElementById("scaleForm").addEventListener("submit", e => {
    e.preventDefault();
    const record = {
      group: document.getElementById("scaleGroup").value,
      element: document.getElementById("scaleElement").value,
      grade: document.getElementById("scaleGrade").value,
      steps: []
    };
    
    // Collect step values
    for(let i = 1; i <= 20; i++) {
      record.steps.push(document.getElementById("step" + i).value || "");
    }
    
    if(editingScaleIndex !== null) {
      scales[editingScaleIndex] = record;
      editingScaleIndex = null;
    } else {
      scales.push(record);
    }
    
    renderScaleTable();
    document.getElementById("scaleForm").reset();
    document.getElementById("stepFields").classList.add("hidden");
    document.getElementById("scaleForm").classList.add("hidden");
  });

  function renderScaleTable() {
    const table = document.getElementById("scaleTable");
    table.innerHTML = scales.map((s, i) => `
      <tr>
        <td class="border px-2 py-3 text-left">${s.group}</td>
        <td class="border px-2 py-3 text-left">${s.element}</td>
        <td class="border px-2 py-3 text-left">${s.grade}</td>
        <td class="border px-2 py-3 text-left">
          <button class="text-blue-600 hover:underline mr-2" onclick="viewScale(${i})">View</button>
          <button class="text-green-600 hover:underline mr-2" onclick="editScale(${i})">Edit</button>
          <button class="text-red-600 hover:underline" onclick="deleteScale(${i})">Delete</button>
        </td>
      </tr>
    `).join("");
  }

  function viewScale(index) {
    const s = scales[index];
    let html = `
      <div class="p-4 border rounded-lg shadow bg-gray-50">
        <p><strong>Salary Code:</strong> ${s.group}</p>
        <p><strong>Paycode:</strong> ${s.element}</p>
        <p><strong>Grade:</strong> ${s.grade}</p>
        <div class="grid grid-cols-4 gap-2 mt-4">`;
    
    for(let i = 0; i < 20; i++) {
      html += `
        <div class="p-2 border rounded bg-white">
          <strong>Step ${i+1}:</strong> ${s.steps[i] || "-"}
        </div>`;
    }
    
    html += `
        </div>
      </div>`;
    
    document.getElementById("scaleViewContent").innerHTML = html;
    document.getElementById("scaleViewModal").classList.remove("hidden");
  }
  
  document.getElementById("closeScaleView").addEventListener("click", () => {
    document.getElementById("scaleViewModal").classList.add("hidden");
  });

  function editScale(index) {
    const s = scales[index];
    document.getElementById("scaleGroup").value = s.group;
    document.getElementById("scaleElement").value = s.element;
    document.getElementById("scaleGrade").value = s.grade;
    
    // Populate step values
    for(let i = 0; i < 20; i++) {
      document.getElementById("step" + (i+1)).value = s.steps[i] || "";
    }
    
    editingScaleIndex = index;
    document.getElementById("stepFields").classList.remove("hidden");
    document.getElementById("scaleForm").classList.remove("hidden");
    showSection("scaleSection","btnScales");
  }

  function deleteScale(index) {
    if(confirm("Delete this scale?")) {
      scales.splice(index, 1);
      renderScaleTable();
    }
  }

  // Render initial group table
  function renderGroupTable() {
    const t = document.getElementById("groupTable");
    t.innerHTML = groups.map((g, i) => `
      <tr>
        <td class="border px-2 py-3 text-left">${g.groupcode}</td>
        <td class="border px-2 py-3 text-left">${g.grpdesc}</td>
        <td class="border px-2 py-3 text-left">${g.effdate}</td>
        <td class="border px-2 py-3 text-left">${g.lastdate}</td>
        <td class="border px-2 py-3 text-left">
          <button class="text-green-600 hover:underline mr-2" onclick="editGroup(${i})">Edit</button>
          <button class="text-red-600 hover:underline" onclick="deleteGroup(${i})">Delete</button>
        </td>
      </tr>`).join("");
  }

  function deleteGroup(index) {
    if(confirm("Delete this group?")) {
      groups.splice(index, 1);
      renderGroupTable();
      loadDropdowns(); // Refresh dropdowns
    }
  }

  // Initialize
  renderGroupTable();
  renderScaleTable();
  loadDropdowns();
</script>

</body>
</html>