<!-- Payroll Files Listing -->
<section class="p-6">
  <h2 class="text-xl border-b font-bold text-blue-600 mb-12"> Payroll Files Reports List</h2>

  <!-- Filters -->
  <form id="fileFilterForm" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    <!-- Month -->
    <div>
      <label class="block text-sm font-medium mb-1">Processing Month</label>
      <select id="fileMonth" class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300">
        <option value="">All Months</option>
        <option>January</option><option>February</option><option>March</option>
        <option>April</option><option>May</option><option>June</option>
        <option>July</option><option>August</option><option>September</option>
        <option>October</option><option>November</option><option>December</option>
      </select>
    </div>

    <!-- Department -->
    <div>
      <label class="block text-sm font-medium mb-1">Department</label>
      <select id="fileDept" class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300">
        <option value="">All Departments</option>
        <option>CPO</option>
        <option>MPB</option>
      </select>
    </div>

    <!-- File Type -->
    <div>
      <label class="block text-sm font-medium mb-1">File Type</label>
      <select id="fileType" class="w-full border rounded px-3 py-2 focus:ring focus:ring-blue-300">
        <option value="">All Types</option>
        <option>Payroll Register</option>
        <option>Payslip</option>
        <option>Tax Report</option>
        <option>Loan Analysis</option>
        <option>Other</option>
      </select>
    </div>
  </form>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="w-full text-sm border">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-3 py-2 border text-blue-600">File Name</th>
          <th class="px-3 py-2 border text-blue-600">Type</th>
          <th class="px-3 py-2 border text-blue-600">Month</th>
          <th class="px-3 py-2 border text-blue-600">Department</th>
          <th class="px-3 py-2 border text-center text-blue-600">Actions</th>
        </tr>
      </thead>
      <tbody id="fileTableBody">
        <tr>
          <td class="px-3 py-2 border">Payroll_Register_Jan2025.pdf</td>
          <td class="px-3 py-2 border">Payroll Register</td>
          <td class="px-3 py-2 border">January</td>
          <td class="px-3 py-2 border">CPO</td>
          <td class="px-3 py-2 border text-center space-x-2">
            <button class="viewBtn px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">View</button>
            <button class="downloadBtn px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">Download</button>
            <button class="printBtn px-2 py-1 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600">Print</button>
            <button class="deleteBtn px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">Delete</button>
          </td>
        </tr>
        <tr>
          <td class="px-3 py-2 border">Payslip_Feb2025.pdf</td>
          <td class="px-3 py-2 border">Payslip</td>
          <td class="px-3 py-2 border">February</td>
          <td class="px-3 py-2 border">All</td>
          <td class="px-3 py-2 border text-center space-x-2">
            <button class="viewBtn px-2 py-1 bg-blue-500 text-white rounded text-xs hover:bg-blue-600">View</button>
            <button class="downloadBtn px-2 py-1 bg-green-500 text-white rounded text-xs hover:bg-green-600">Download</button>
            <button class="printBtn px-2 py-1 bg-yellow-500 text-white rounded text-xs hover:bg-yellow-600">Print</button>
            <button class="deleteBtn px-2 py-1 bg-red-500 text-white rounded text-xs hover:bg-red-600">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- View Modal -->
<div id="viewModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-3/4 max-w-2xl p-6">
    <h3 class="text-lg font-semibold mb-4">Preview File</h3>
    <div class="border h-64 flex items-center justify-center text-gray-500 mb-6">
      <span id="previewFileName">File preview goes here...</span>
    </div>
    <div class="flex justify-end">
      <button id="closeViewBtn" class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Close</button>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-96 p-6">
    <h3 class="text-lg font-semibold mb-4 text-red-600">Confirm Delete</h3>
    <p id="deleteFileName" class="mb-6 text-gray-700"></p>
    <div class="flex justify-end gap-2">
      <button id="cancelDeleteBtn" class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Cancel</button>
      <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<!-- Print Modal -->
<div id="printModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-96 p-6 text-center">
    <h3 class="text-lg font-semibold mb-4">Confirm Print</h3>
    <p id="printFileName" class="mb-6 text-gray-700"></p>
    <div class="flex justify-center gap-2">
      <button id="cancelPrintBtn" class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Cancel</button>
      <button id="confirmPrintBtn" class="px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600">Print</button>
    </div>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-96 p-6 text-center">
    <h3 class="text-lg font-semibold text-green-600 mb-4">Success</h3>
    <p id="successMessage" class="mb-6 text-gray-700">Action completed.</p>
    <div class="flex justify-center">
      <button id="successOkBtn" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">OK</button>
    </div>
  </div>
</div>

<script>
  // Elements
  const viewModal = document.getElementById("viewModal");
  const previewFileName = document.getElementById("previewFileName");
  const closeViewBtn = document.getElementById("closeViewBtn");

  const deleteModal = document.getElementById("deleteModal");
  const deleteFileName = document.getElementById("deleteFileName");
  const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
  const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

  const printModal = document.getElementById("printModal");
  const printFileName = document.getElementById("printFileName");
  const cancelPrintBtn = document.getElementById("cancelPrintBtn");
  const confirmPrintBtn = document.getElementById("confirmPrintBtn");

  const successModal = document.getElementById("successModal");
  const successMessage = document.getElementById("successMessage");
  const successOkBtn = document.getElementById("successOkBtn");

  let fileToDeleteRow = null;
  let fileToPrint = null;

  // Helper to show success modal with custom message
  function showSuccess(message) {
    successMessage.textContent = message;
    successModal.classList.remove("hidden");
  }

  // VIEW handlers
  document.querySelectorAll(".viewBtn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const row = e.target.closest("tr");
      const fileName = row.cells[0].textContent.trim();
      previewFileName.textContent = "Previewing: " + fileName;
      viewModal.classList.remove("hidden");
    });
  });
  closeViewBtn.addEventListener("click", () => viewModal.classList.add("hidden"));

  // DOWNLOAD handlers (simulate download)
  document.querySelectorAll(".downloadBtn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const row = e.target.closest("tr");
      const fileName = row.cells[0].textContent.trim();

      // Simulated download: create a small blob and download
      const blob = new Blob([`Simulated content for ${fileName}`], {type: "application/pdf"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      showSuccess(`Downloaded ${fileName}`);
    });
  });

  // PRINT handlers
  document.querySelectorAll(".printBtn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const row = e.target.closest("tr");
      fileToPrint = row.cells[0].textContent.trim();
      printFileName.textContent = "Do you want to print " + fileToPrint + "?";
      printModal.classList.remove("hidden");
    });
  });

  cancelPrintBtn.addEventListener("click", () => {
    printModal.classList.add("hidden");
    fileToPrint = null;
  });

  confirmPrintBtn.addEventListener("click", () => {
    printModal.classList.add("hidden");

    // Call browser print dialog (assume printable view is current page or opened)
    // In real app, you'd open printable view / iframe and call print on that frame.
    try {
      window.print();
      // show success after print call (note: some browsers block/behave differently)
      showSuccess(`Print dialog opened for ${fileToPrint}`);
    } catch (err) {
      showSuccess(`Print attempted for ${fileToPrint}`);
    } finally {
      fileToPrint = null;
    }
  });

  // DELETE handlers
  document.querySelectorAll(".deleteBtn").forEach(btn => {
    btn.addEventListener("click", (e) => {
      const row = e.target.closest("tr");
      fileToDeleteRow = row;
      const fileName = row.cells[0].textContent.trim();
      deleteFileName.textContent = "Are you sure you want to delete " + fileName + "?";
      deleteModal.classList.remove("hidden");
    });
  });

  cancelDeleteBtn.addEventListener("click", () => {
    deleteModal.classList.add("hidden");
    fileToDeleteRow = null;
  });

  confirmDeleteBtn.addEventListener("click", () => {
    if (fileToDeleteRow) {
      const fileName = fileToDeleteRow.cells[0].textContent.trim();
      fileToDeleteRow.remove();
      fileToDeleteRow = null;
      deleteModal.classList.add("hidden");
      showSuccess(`Deleted ${fileName}`);
    } else {
      deleteModal.classList.add("hidden");
    }
  });

  // Success OK closes modal
  successOkBtn.addEventListener("click", () => {
    successModal.classList.add("hidden");
  });
</script>
