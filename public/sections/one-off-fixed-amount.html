<div class="p-6">
<div class="">
<!-- Header -->
<div class="px-6 py-2 flex flex-wrap gap-2 items-center justify-between">
    <div class="flex items-center">
        <h1 class="text-xl font-semibold">One-Off Fixed Amount By Rank Management</h1>
    </div>
        <!-- Add Button -->
    <div class="mb-2 flex justify-end">
        <button id="showFormBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add New</button>
    </div>
</div>

<div class="p-6">
    <!-- Hidden Form -->
    <div id="rankAmountForm" class="hidden mb-2">
        <!-- Description Section -->
        <div class="mb-2">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Description</label>
            <input type="text" id="description" class="w-full lg:w-1/2 md:w-2/3 border-2 border-blue-500 bg-transparent rounded px-3 py-2 text-sm focus:border-blue-600 focus:outline-none" placeholder="Enter description">
        </div>

        <!-- Rank Grid -->
        <div class="mb-4">
            <h3 class="text-lg lg:text-lg font-bold text-blue-700 mb-2">Set One-Off Fixed Amounts by Rank</h3>
            
            <!-- First Row -->
            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-4">
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Trainee</label>
                    <input type="number" id="trainee" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">OS</label>
                    <input type="number" id="os" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">SM</label>
                    <input type="number" id="sm" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">AB</label>
                    <input type="number" id="ab" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">LS</label>
                    <input type="number" id="ls" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">PO</label>
                    <input type="number" id="po" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
            </div>

            <!-- Second Row -->
            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 border-b-2 pb-4">
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">WO</label>
                    <input type="number" id="wo" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">MWO</label>
                    <input type="number" id="mwo" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">CADET</label>
                    <input type="number" id="cadet" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">NWO</label>
                    <input type="number" id="nwo" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1"></label>
                    <div class="border border-transparent rounded px-2 py-1 text-xs"></div>
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1"></label>
                    <div class="border border-transparent rounded px-2 py-1 text-xs"></div>
                </div>
            </div>

            <!-- Third Row -->
            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 pt-2 mb-4">
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">MIDSHIPMAN</label>
                    <input type="number" id="midshipman" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">S/Lt</label>
                    <input type="number" id="slt" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Lt</label>
                    <input type="number" id="lt" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Lt/Cdr</label>
                    <input type="number" id="ltcdr" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Cdr</label>
                    <input type="number" id="cdr" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Capt</label>
                    <input type="number" id="capt" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
            </div>

            <!-- Fourth Row -->
            <div class="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Cdre</label>
                    <input type="number" id="cdre" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">R/Adm</label>
                    <input type="number" id="radm" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">V/Adm</label>
                    <input type="number" id="vadm" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Adm</label>
                    <input type="number" id="adm" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Contract</label>
                    <input type="number" id="contract" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
                <div class="flex flex-col">
                    <label class="text-xs font-semibold text-gray-700 mb-1">Rtd Officers</label>
                    <input type="number" id="rtdofficers" class="border border-gray-300 rounded px-2 py-1 text-xs focus:border-blue-500 focus:outline-none" placeholder="0">
                </div>
            </div>
        </div>

        <!-- Form Buttons -->
        <div class="flex justify-end gap-2">
            <button id="saveBtn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Save</button>
            <button id="cancelBtn" class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500">Cancel</button>
        </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
        <table class="min-w-full border border-gray-200 rounded-lg text-sm">
            <thead class="bg-blue-100 text-blue-900">
                <tr>
                    <th class="border px-4 py-3 text-left">Description</th>
                    <th class="border px-4 py-3 text-center">Actions</th>
                </tr>
            </thead>
            <tbody id="rankAmountTable" class="text-center"></tbody>
        </table>
    </div>
</div>
</div>
</div>

<!-- Success Modal -->
<div id="successModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
<div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
<h3 class="text-lg font-semibold mb-2 text-green-600">Success!</h3>
<p class="mb-4 text-gray-700">Your changes have been saved successfully!</p>
<button id="closeSuccessModal" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">OK</button>
</div>
</div>

<!-- View Modal -->
<div id="viewModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
<div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-screen overflow-y-auto">
<div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold text-blue-600">Fixed Amount by Rank Details</h3>
    <button id="closeViewModal" class="text-gray-400 hover:text-gray-600">
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
    </button>
</div>
<div id="viewContent"></div>
</div>
</div>

<script>
let editingIndex = null;

// Dummy data
let data = [
{
    description: "One-Off Allowance",
    createdDate: "2024-01-15",
    ranks: {
        trainee: 50000, os: 65000, sm: 80000, ab: 95000, ls: 110000, po: 125000,
        wo: 150000, mwo: 175000, cadet: 45000, nwo: 200000,
        midshipman: 85000, slt: 180000, lt: 220000, ltcdr: 280000, cdr: 350000, capt: 420000,
        cdre: 500000, radm: 650000, vadm: 800000, adm: 1000000, contract: 75000, rtdofficers: 90000
    }
},
{
    description: "Transport Allowance",
    createdDate: "2024-02-10",
    ranks: {
        trainee: 15000, os: 20000, sm: 25000, ab: 30000, ls: 35000, po: 40000,
        wo: 45000, mwo: 50000, cadet: 12000, nwo: 55000,
        midshipman: 25000, slt: 50000, lt: 60000, ltcdr: 75000, cdr: 90000, capt: 105000,
        cdre: 120000, radm: 140000, vadm: 160000, adm: 180000, contract: 20000, rtdofficers: 25000
    }
},
{
    description: "One-Off Extra Housing Allowance",
    createdDate: "2024-03-05",
    ranks: {
        trainee: 25000, os: 30000, sm: 40000, ab: 50000, ls: 60000, po: 70000,
        wo: 85000, mwo: 100000, cadet: 20000, nwo: 120000,
        midshipman: 45000, slt: 100000, lt: 130000, ltcdr: 160000, cdr: 200000, capt: 240000,
        cdre: 300000, radm: 380000, vadm: 460000, adm: 550000, contract: 35000, rtdofficers: 45000
    }
}
];

const form = document.getElementById("rankAmountForm");
const showFormBtn = document.getElementById("showFormBtn");
const saveBtn = document.getElementById("saveBtn");
const cancelBtn = document.getElementById("cancelBtn");
const tableBody = document.getElementById("rankAmountTable");

const rankFields = [
'trainee', 'os', 'sm', 'ab', 'ls', 'po', 'wo', 'mwo', 'cadet', 'nwo',
'midshipman', 'slt', 'lt', 'ltcdr', 'cdr', 'capt', 'cdre', 'radm', 'vadm', 'adm', 'contract', 'rtdofficers'
];

// Make functions global
window.viewRow = function(index) {
const item = data[index];
let html = `
    <div class="mb-4">
        <h4 class="text-lg font-semibold text-gray-800 mb-2">Description: ${item.description}</h4>
        <p class="text-sm text-gray-600 mb-4">Created: ${item.createdDate}</p>
    </div>
    <div class="border-2 border-gray-300 rounded-lg p-4 bg-gray-50">
        <h5 class="font-semibold text-gray-700 mb-3">Fixed Amounts by Rank:</h5>
        <div class="grid grid-cols-4 gap-4 text-sm">
`;

for (let rank in item.ranks) {
    const displayRank = rank.charAt(0).toUpperCase() + rank.slice(1);
    const amount = new Intl.NumberFormat('en-NG', { style: 'currency', currency: 'NGN' }).format(item.ranks[rank]);
    html += `
        <div class="flex justify-between bg-white p-2 rounded border">
            <span class="font-medium">${displayRank.replace(/([A-Z])/g, ' $1').trim()}:</span>
            <span class="text-green-600 font-semibold">${amount}</span>
        </div>
    `;
}

html += `</div></div>`;
document.getElementById("viewContent").innerHTML = html;
openModal("viewModal");
};

window.editRow = function(index) {
const item = data[index];
document.getElementById("description").value = item.description;

// Populate rank fields
rankFields.forEach(rank => {
    const field = document.getElementById(rank);
    if (field) {
        field.value = item.ranks[rank] || 0;
    }
});

editingIndex = index;
form.classList.remove("hidden");
};

window.deleteRow = function(index) {
if (confirm("Are you sure you want to delete this fixed amount configuration?")) {
    data.splice(index, 1);
    renderTable();
}
};

function renderTable() {
tableBody.innerHTML = data.map((item, index) => {
    return `
        <tr class="hover:bg-gray-50">
            <td class="border px-4 py-2 text-left">${item.description}</td>
            <td class="border px-4 py-2 text-center">
                <button onclick="viewRow(${index})" class="text-blue-600 hover:text-blue-800 mr-2 px-2 py-1 rounded hover:bg-blue-50">View</button>
                <button onclick="editRow(${index})" class="text-green-600 hover:text-green-800 mr-2 px-2 py-1 rounded hover:bg-green-50">Edit</button>
                <button onclick="deleteRow(${index})" class="text-red-600 hover:text-red-800 px-2 py-1 rounded hover:bg-red-50">Delete</button>
            </td>
        </tr>
    `;
}).join("");
}

renderTable();

showFormBtn.addEventListener("click", () => {
form.classList.remove("hidden");
editingIndex = null;
clearForm();
});

cancelBtn.addEventListener("click", () => {
form.classList.add("hidden");
editingIndex = null;
clearForm();
});

saveBtn.addEventListener("click", () => {
const description = document.getElementById("description").value.trim();

if (!description) {
    alert("Please enter a description");
    return;
}

const ranks = {};
rankFields.forEach(rank => {
    const field = document.getElementById(rank);
    if (field) {
        ranks[rank] = parseFloat(field.value) || 0;
    }
});

const item = {
    description: description,
    createdDate: editingIndex !== null ? data[editingIndex].createdDate : new Date().toISOString().split('T')[0],
    ranks: ranks
};

if (editingIndex !== null) {
    data[editingIndex] = item;
    editingIndex = null;
} else {
    data.push(item);
}

renderTable();
form.classList.add("hidden");
clearForm();
openModal("successModal");
});

function clearForm() {
document.getElementById("description").value = "";
rankFields.forEach(rank => {
    const field = document.getElementById(rank);
    if (field) {
        field.value = "";
    }
});
}

function openModal(id) {
document.getElementById(id).classList.remove("hidden");
}

function closeModal(id) {
document.getElementById(id).classList.add("hidden");
}

document.getElementById('closeSuccessModal').addEventListener('click', () => {
closeModal('successModal');
});

document.getElementById('closeViewModal').addEventListener('click', () => {
closeModal('viewModal');
});

// Close modals when clicking outside
document.getElementById('successModal').addEventListener('click', (e) => {
if (e.target === e.currentTarget) closeModal('successModal');
});

document.getElementById('viewModal').addEventListener('click', (e) => {
if (e.target === e.currentTarget) closeModal('viewModal');
});
</script>
