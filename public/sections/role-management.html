<!-- ROLE MANAGEMENT SECTION -->
<div class="p-6">
  <div class="flex items-center justify-between p-4 border-b">
    <h2 class="text-lg font-semibold text-blue-800">Current Roles</h2>
    <button id="toggleRoleFormBtn" 
      class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">+ Add New Role</button>
  </div>

  <!-- Add New Role Form -->
  <div id="roleFormWrap" class="hidden p-4 border-b">
    <form id="roleForm" class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Role Name*</label>
        <input type="text" id="roleName" required 
          class="w-full border border-blue-500 rounded px-3 py-2 focus:ring-2 focus:ring-yellow-500">
      </div>
      <div class="md:col-span-2">
        <label class="block text-sm font-medium text-gray-700">Role Description*</label>
        <textarea id="roleDesc" required rows="3"
          class="w-full border border-blue-500 rounded px-3 py-2 focus:ring-2 focus:ring-yellow-500"></textarea>
      </div>
      <div class="md:col-span-2 flex justify-end space-x-4 pt-2">
        <button type="button" id="cancelRoleBtn" 
          class="px-4 py-2 bg-gray-400 text-white rounded hover:bg-gray-500">Cancel</button>
        <button type="submit" id="saveRoleBtn"
          class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
      </div>
    </form>
  </div>

  <!-- Role List Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full text-sm text-left border-collapse">
      <thead class="bg-blue-50 border-b">
        <tr>
          <th class="px-4 py-2 text-gray-700">ROLES</th>
          <th class="px-4 py-2 text-gray-700">ROLE ACTION</th>
          <th class="px-4 py-2 text-gray-700">ACTIONS</th>
        </tr>
      </thead>
      <tbody id="roleList">
        <tr class="border-b">
          <td class="px-4 py-2 font-medium">Data Entry</td>
          <td class="px-4 py-2">Access to Data Input only, can view/print own entries</td>
            <td class="px-4 py-2 space-x-2">
            <button class="editBtn text-green-600 hover:underline">Edit</button>
            <button class="deleteBtn text-red-600 hover:underline">Delete</button>
          </td>
        </tr>
        <tr class="border-b">
          <td class="px-4 py-2 font-medium">Operator</td>
          <td class="px-4 py-2">Data Entry, View, Print all data, Approve same</td>
            <td class="px-4 py-2 space-x-2">
            <button class="editBtn text-green-600 hover:underline">Edit</button>
            <button class="deleteBtn text-red-600 hover:underline">Delete</button>
          </td>
        </tr>
        <tr class="border-b">
          <td class="px-4 py-2 font-medium">Processor</td>
          <td class="px-4 py-2">Operator tasks + process payroll + reports (cannot manage users/payment types)</td>
            <td class="px-4 py-2 space-x-2">
            <button class="editBtn text-green-600 hover:underline">Edit</button>
            <button class="deleteBtn text-red-600 hover:underline">Delete</button>
          </td>
        </tr>
        <tr class="border-b">
          <td class="px-4 py-2 font-medium">Manager</td>
          <td class="px-4 py-2">Processor tasks + manage users & payment types</td>
            <td class="px-4 py-2 space-x-2">
            <button class="editBtn text-green-600 hover:underline">Edit</button>
            <button class="deleteBtn text-red-600 hover:underline">Delete</button>
          </td>
        </tr>
        <tr>
          <td class="px-4 py-2 font-medium">HICAD</td>
          <td class="px-4 py-2">Full access to everything</td>
            <td class="px-4 py-2 space-x-2">
            <button class="editBtn text-green-600 hover:underline">Edit</button>
            <button class="deleteBtn text-red-600 hover:underline">Delete</button>
            </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Confirm Delete</h3>
        <p class="text-gray-600 mb-6">Are you sure you want to delete this record? This action cannot be undone.</p>
        <div class="flex justify-end space-x-4">
            <button id="cancelDelete" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancel</button>
            <button id="confirmDelete" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Delete</button>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm hidden flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-8 max-w-sm w-full mx-4 text-center">
        <div id="loadingSpinner" class="flex justify-center mb-4">
              <div class="relative w-10 h-10">
                <!-- Left bar (bottom-up) -->
                <div class="absolute left-1 w-[6px] bg-blue-600 rounded animate-grow-up"></div>

                <!-- Right bar (top-down) -->
                <div class="absolute right-1 w-[6px] bg-blue-600 rounded animate-grow-down [animation-delay:0.3s]"></div>

                <!-- Middle bar -->
                <div class="absolute top-1/2 left-1 h-[6px] bg-blue-600 rounded animate-expand [animation-delay:0.6s] -translate-y-1/2"></div>
              </div>
        </div>
        <div id="successTick" class="hidden flex justify-center mb-4">
            <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
        </div>
        <p id="successMessage" class="text-gray-700 font-medium">Processing...</p>
    </div>
</div>

<script>
  const toggleRoleFormBtn = document.getElementById("toggleRoleFormBtn");
  const roleFormWrap = document.getElementById("roleFormWrap");
  const cancelRoleBtn = document.getElementById("cancelRoleBtn");
  const roleForm = document.getElementById("roleForm");
  const roleList = document.getElementById("roleList");
  const roleNameInput = document.getElementById("roleName");
  const roleDescInput = document.getElementById("roleDesc");
  const saveRoleBtn = document.getElementById("saveRoleBtn");

      // Modals
    const confirmModal = document.getElementById("confirmModal");
    const successModal = document.getElementById("successModal");
    const loadingSpinner = document.getElementById("loadingSpinner");
    const successTick = document.getElementById("successTick");
    const successMessage = document.getElementById("successMessage");

  // Toggle form
  toggleRoleFormBtn.addEventListener("click", () => {
    roleFormWrap.classList.toggle("hidden");
  });
  cancelRoleBtn.addEventListener("click", () => {
    roleForm.reset();
    roleFormWrap.classList.add("hidden");
  });

  // Add new role
  roleForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const name = document.getElementById("roleName").value;
    const desc = document.getElementById("roleDesc").value;

    const row = document.createElement("tr");
    row.className = "border-b";
    row.innerHTML = `
      <td class="px-4 py-2 font-medium">${name}</td>
      <td class="px-4 py-2">${desc}</td>
      <td class="px-4 py-2 space-x-2">
          <button class="editBtn text-green-600 hover:underline">Edit</button>
          <button class="deleteBtn text-red-600 hover:underline">Delete</button>
      </td>
    `;
    roleList.appendChild(row);

    roleForm.reset();
    roleFormWrap.classList.add("hidden");
  });

  // Simulated actions
let editingRow = null; // track the row being edited

// Event delegation for Edit/Delete
roleList.addEventListener("click", (e) => {
  const row = e.target.closest("tr");
  if (!row) return;

  if (e.target.classList.contains("editBtn")) {
    const cells = row.querySelectorAll('td');
    const roleName = cells[0].textContent;
    const roleDesc = cells[1].textContent;

    roleNameInput.value = roleName;
    roleDescInput.value = roleDesc;

    editingRow = row; // remember which row we are editing
    roleFormWrap.classList.remove("hidden");
  }

  if (e.target.classList.contains("deleteBtn")) {
    row.remove();
    showSuccessModal("Role deleted!");
  }
});

// Save button
saveRoleBtn.addEventListener("click", () => {
  const name = roleNameInput.value.trim();
  const desc = roleDescInput.value.trim();

  if (!name || !desc) {
    showErrorModal("Please fill in all fields!");
    return;
  }

  if (editingRow) {
    // Update existing row
    const cells = editingRow.querySelectorAll('td');
    cells[0].textContent = name;
    cells[1].textContent = desc;
    showSuccessModal("Role updated!");
    editingRow = null;
  } else {
    // Create new row
    const newRow = document.createElement("tr");
    newRow.innerHTML = `
      <td class="px-4 py-2 font-medium">${name}</td>
      <td class="px-4 py-2">${desc}</td>
      <td class="px-4 py-2 space-x-2">
          <button class="editBtn text-green-600 hover:underline">Edit</button>
          <button class="deleteBtn text-red-600 hover:underline">Delete</button>
      </td>
    `;
    roleList.appendChild(newRow);
    showSuccessModal("Role added!");
  }

  resetForm();
  roleFormWrap.classList.add("hidden");
});

// Cancel button
cancelRoleBtn.addEventListener("click", () => {
  resetForm();
  roleFormWrap.classList.add("hidden");
  editingRow = null;
});

// Reset form
function resetForm() {
  roleNameInput.value = "";
  roleDescInput.value = "";
}

function showSuccessModal(message) {
  successMessage.textContent = "Processing...";
  loadingSpinner.classList.remove("hidden");
  successTick.classList.add("hidden");
  successModal.classList.remove("hidden");

  // Show spinner for 1.8 seconds
  setTimeout(() => {
      loadingSpinner.classList.add("hidden");
      successTick.classList.remove("hidden");
      successMessage.textContent = message;
      
      // Hide modal after 1.5 seconds
      setTimeout(() => {
          successModal.classList.add("hidden");
      }, 1500);
  }, 1800);
}
</script>
