<div class="p-6">
  <!-- Add New Button -->
  <div class="flex justify-end mb-4">
    <button
      id="addNewBtn"
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
    >
      + Add New
    </button>
  </div>

  
  <!-- Add/Edit Form (hidden initially) -->
  <div
    id="salaryForm"
    class="hidden items mb-4 border rounded-lg p-4 max-w-lg mr-auto">
    <h4 class="text-md font-bold text-blue-600 mb-3">Add/Edit Overpayment Percentage</h4>
    <form class="space-y-4">
      <div>
        <label class="block text-sm font-medium mb-1">Basic Salary</label>
        <input
          type="text"
          id="salaryInput"
          class="w-full border rounded px-3 py-2 text-sm"
          placeholder="Enter Basic Salary"/>
      </div>
      <div>
        <label class="block text-sm font-medium mb-1">Percentage</label>
        <input
          type="number"
          id="percentageInput"
          step="0.1"
          class="w-full border rounded px-3 py-2 text-sm"
          placeholder="Enter Overpayment Percentage"/>
      </div>
      <div class="flex justify-end space-x-3">
        <button
          type="button"
          id="saveBtn"
          class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
          Save
        </button>
        <button
          type="button"
          id="cancelBtn"
          class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border text-sm">
      <thead class="bg-blue-100">
        <tr>
          <th class="border px-3 py-2 text-left">Basic Salary Record</th>
          <th class="border px-3 py-2 text-left">Overpayment Percentage (%)</th>
          <th class="border px-3 py-2 text-center">Actions</th>
        </tr>
      </thead>
      <tbody id="salaryTable">
        <!-- Dummy data -->
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
  <div class="bg-white p-6 rounded-xl shadow-xl text-center">
    <p class="text-lg font-semibold text-green-600">âœ… Saved Successfully!</p>
  </div>
</div>

<!-- Alert Modal -->
<div id="alertModal" 
     class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
  <div class="bg-white rounded-lg shadow-xl max-w-sm w-full p-6 text-center">
    <h3 id="alertTitle" class="text-lg font-semibold text-gray-800 mb-2">Alert!</h3>
    <p id="alertMessage" class="text-gray-600 mb-4"></p>
    <button id="alertOkBtn" 
      class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
      OK
    </button>
  </div>
</div>


<script>
const apiUrl = "/overpayment"; 
let bt04 = null; // holds BT04 record

function showModal() { 
  const modal = document.getElementById('successModal'); 
  modal.classList.remove("hidden"); 
  setTimeout(() => 
  modal.classList.add("hidden"), 1000); 
}

function showAlert(message, title = "Alert") {
  const modal = document.getElementById("alertModal");
  const msg = document.getElementById("alertMessage");
  const ttl = document.getElementById("alertTitle");
  const okBtn = document.getElementById("alertOkBtn");

  ttl.textContent = title;
  msg.textContent = message;

  modal.classList.remove("hidden");

  okBtn.onclick = () => {
    modal.classList.add("hidden");
  };
}


const salaryMap = {
  1: "BASIC PAY",
  2: "HOUSING ALLOWANCE",
  3: "TRANSPORT ALLOWANCE",
  4: "MEAL SUBSIDY"
};

async function loadOverpayment() {
  const res = await fetch(apiUrl, { 
    headers: { "Authorization": `Bearer ${localStorage.getItem("token")}` }
  });
  bt04 = await res.json();

 renderTable();

}

// Render table
function renderTable() {
  salaryTable.innerHTML = "";
  if (bt04 && bt04.basicpay) {
    const code = parseInt(bt04.basicpay);
    const label = salaryMap[code] || bt04.basicpay;
    const row = document.createElement("tr");
    row.innerHTML = `
      <td class="border px-3 py-2">${label}</td>
      <td class="border px-3 py-2">${bt04.ord || 0}%</td>
      <td class="border px-3 py-2 text-center">
        <button class="text-blue-500 editBtn">Edit</button>
      </td>
    `;
    salaryTable.appendChild(row);
  }
}

// Show form
addNewBtn.addEventListener("click", () => {
  salaryInput.value = bt04?.basicpay || "";
  percentageInput.value = bt04?.ord || ""; // use "ord" or another float col
  salaryForm.classList.remove("hidden");
});

// Save
saveBtn.addEventListener("click", async () => {
  const salary = salaryInput.value.trim();
  const percentage = parseFloat(percentageInput.value);

  if (!salary || isNaN(percentage)) {
    showAlert("Please enter salary and percentage");
    return;
  }

  const body = JSON.stringify({ basicpay: salary, ord: percentage });
  const headers = { "Content-Type": "application/json", "Authorization": `Bearer ${localStorage.getItem("token")}` };

  if (bt04 && bt04.type === "BT04") {
    const res = await fetch(apiUrl, { method: "PUT", headers, body });
    if (!res.ok) throw new Error("Failed to update");
    showModal();
  } else {
    const res = await fetch(apiUrl, { method: "POST", headers, body });
    if (!res.ok) throw new Error("Failed to create");
    showModal();
  }
  
  salaryForm.classList.add("hidden");
  await loadOverpayment();
});

// Edit
salaryTable.addEventListener("click", (e) => {
  if (e.target.classList.contains("editBtn")) {
    salaryInput.value = bt04.basicpay;
    percentageInput.value = bt04.ord || 0;
    salaryForm.classList.remove("hidden");
  }
});

// Cancel
cancelBtn.addEventListener("click", () => {
  salaryForm.classList.add("hidden");
});

// Init
loadOverpayment();
</script>
