<div class="p-6">
  <!-- Section Command Header -->
  <div class="flex flex-wrap justify-between mb-6">
    <h3 class="text-xl font-semibold text-gray-800">Command Management</h3>
    <div class="flex gap-2">
      <input type="text" id="searchSection" placeholder="Name or UnitCode..." class="border rounded px-3 py-2">
      <button id="addNewSectionBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add Command</button>
    </div>
  </div>

  <!-- Hidden Section Command Form -->
  <form id="sectionForm" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Name *</label>
      <input type="text" id="sectionName" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white" placeholder="Enter name">
    </div>
    <div class="">
      <label class="block text-sm font-medium text-gray-700">Description</label>
      <textarea id="sectionDesc" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white" placeholder="Enter description"></textarea>
    </div>
    <div class="col-span-1 md:col-span-2 flex justify-end gap-2">
      <button type="button" id="saveSectionBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Save</button>
      <button type="button" id="cancelSectionBtn" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
    </div>
  </form>

  <!-- Section Command Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-blue-100 text-blue-900">
        <tr>
          <th class="border px-2 py-3 text-left">Code</th>
          <th class="border px-2 py-3 text-left">Name</th>
          <th class="border px-2 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="sectionTableBody"></tbody>
    </table>
  </div>
</div>

<!-- Success Modal -->
<div id="sectionSuccessModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-green-600 mb-2">Success!</h3>
    <p id="sectionSuccessMessage" class="mb-4 text-gray-700"></p>
    <div class="flex justify-end">
      <button id="closeSectionSuccess" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">OK</button>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div id="sectionErrorModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-red-600 mb-2">Error</h3>
    <p id="sectionErrorMessage" class="mb-4 text-gray-700"></p>
    <div class="flex justify-end">
      <button id="closeSectionError" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">OK</button>
    </div>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div id="sectionConfirmModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-yellow-600 mb-2">Confirm Delete</h3>
    <p class="mb-4 text-gray-700">Are you sure you want to delete this section command?</p>
    <div class="flex justify-end gap-2">
      <button id="cancelSectionDelete" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
      <button id="sectionConfirmAction" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<script>
  let sectionData = [
    { name: "DHQ", description: "DEFENCE HEADQUARTERS"},
    { name: "AB", description: "ACCOUNTS AND BUDGET"}
  ];
  let editingSectionIndex = null;
  let pendingSectionDelete = null;

  const sectionForm = document.getElementById("sectionForm");
  const addNewSectionBtn = document.getElementById("addNewSectionBtn");
  const saveSectionBtn = document.getElementById("saveSectionBtn");
  const cancelSectionBtn = document.getElementById("cancelSectionBtn");
  const sectionTableBody = document.getElementById("sectionTableBody");
  const searchSection = document.getElementById("searchSection");

  // Show form
  addNewSectionBtn.addEventListener("click", () => {
    sectionForm.classList.remove("hidden");
    editingSectionIndex = null;
    resetSectionForm();
  });

  // Save record
  saveSectionBtn.addEventListener("click", () => {
    const sectionRecord = {
      name: document.getElementById("sectionName").value.trim(),
      description: document.getElementById("sectionDesc").value.trim(),
    };

    if (!sectionRecord.name || !sectionRecord.description) {
      showSectionError("Please fill in required fields: Name, Code");
      return;
    }

    if (editingSectionIndex !== null) {
      sectionData[editingSectionIndex] = sectionRecord;
      showSectionSuccess("Section updated successfully!");
      editingSectionIndex = null;
    } else {
      sectionData.push(sectionRecord);
      showSectionSuccess("Section saved successfully!");
    }

    renderSectionTable();
    sectionForm.classList.add("hidden");
    resetSectionForm();
  });

  cancelSectionBtn.addEventListener("click", () => {
    sectionForm.classList.add("hidden");
    resetSectionForm();
    editingSectionIndex = null;
  });

  function resetSectionForm() {
    sectionForm.querySelectorAll("input, textarea").forEach(el => el.value = "");
  }

  function renderSectionTable(filtered = sectionData) {
    sectionTableBody.innerHTML = filtered.map((item, index) => `
      <tr class="hover:bg-gray-50">
        <td class="border px-2 py-3">${item.name}</td>
        <td class="border px-2 py-3">${item.description || "N/A"}</td>
        <td class="border px-2 py-3">
          <button id="editSection-${index}" class="text-green-600 hover:text-green-900 mr-2">Edit</button>
          <button id="deleteSection-${index}" class="text-red-600 hover:text-red-900">Delete</button>
        </td>
      </tr>
    `).join("");

    // attach events
    filtered.forEach((_, index) => {
      document.getElementById(`editSection-${index}`).addEventListener("click", () => editSection(index));
      document.getElementById(`deleteSection-${index}`).addEventListener("click", () => deleteSection(index));
    });
  }

  function editSection(index) {
    const item = sectionData[index];
    document.getElementById("sectionName").value = item.name;
    document.getElementById("sectionDesc").value = item.description;
    editingSectionIndex = index;
    sectionForm.classList.remove("hidden");
  }

  function deleteSection(index) {
    pendingSectionDelete = index;
    showModal("sectionConfirmModal");
  }

  document.getElementById("sectionConfirmAction").addEventListener("click", () => {
    if (pendingSectionDelete !== null) {
      sectionData.splice(pendingSectionDelete, 1);
      renderSectionTable();
      showSectionSuccess("Section deleted successfully!");
      pendingSectionDelete = null;
    }
    closeModal("sectionConfirmModal");
  });

  document.getElementById("cancelSectionDelete").addEventListener("click", () => {
    closeModal("sectionConfirmModal");
    pendingSectionDelete = null;
  });

  function showModal(modalId) {
    document.getElementById(modalId).classList.remove("hidden");
  }
  function closeModal(modalId) {
    document.getElementById(modalId).classList.add("hidden");
  }
  function showSectionSuccess(msg) {
    document.getElementById("sectionSuccessMessage").textContent = msg;
    showModal("sectionSuccessModal");
  }
  function showSectionError(msg) {
    document.getElementById("sectionErrorMessage").textContent = msg;
    showModal("sectionErrorModal");
  }

  // close modal buttons
  document.getElementById("closeSectionSuccess").addEventListener("click", () => closeModal("sectionSuccessModal"));
  document.getElementById("closeSectionError").addEventListener("click", () => closeModal("sectionErrorModal"));

  // search
  searchSection.addEventListener("input", () => {
    const query = searchSection.value.toLowerCase();
    const filtered = sectionData.filter(item =>
      item.name.toLowerCase().includes(query) || item.unitCode.toLowerCase().includes(query)
    );
    renderSectionTable(filtered);
  });

  // init
  renderSectionTable();
</script>
