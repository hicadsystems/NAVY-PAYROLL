<!-- Payroll Class Setup -->
<div class="p-6">
  <h2 class="text-2xl font-bold text-blue-800 mb-6">Add New Record</h2>
  
  <!-- Form -->
  <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
      <input id="payrollCode" type="text" placeholder="Enter Code"
          class="border bg-transparent border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500" />
      <input id="payrollDesc" type="text" placeholder="Enter Description"
          class="border bg-transparent border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500" />
      <input id="payrollYear" type="text" placeholder="Enter Year"
          class="border bg-transparent border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500" />
      <select id="payrollMonth" class="border bg-transparent border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500">
          <option value="">Select Month</option>
          <option value="01">01 - January</option>
          <option value="02">02 - February</option>
          <option value="03">03 - March</option>
          <option value="04">04 - April</option>
          <option value="05">05 - May</option>
          <option value="06">06 - June</option>
          <option value="07">07 - July</option>
          <option value="08">08 - August</option>
          <option value="09">09 - September</option>
          <option value="10">10 - October</option>
          <option value="11">11 - November</option>
          <option value="12">12 - December</option>
      </select>
      <button id="addPayrollBtn"
          class="px-6 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700 transition">
          Add Payroll Class
      </button>
  </div>

  <!--<div class="mb-6">
      <button onclick="window.navigation?.navigateToSection?.('change-payroll-class', 'Change Payroll Class')" 
          class="px-6 py-2 bg-green-600 text-white rounded-lg shadow hover:bg-green-700 transition">
          Change Payroll Class
      </button>
  </div>-->

  <!-- Table -->
  <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 rounded-lg text-sm">
          <thead class="bg-blue-100 text-blue-900">
              <tr>
                  <th class="py-2 px-4 border">CODE</th>
                  <th class="py-2 px-4 border">DESCRIPTION</th>
                  <th class="py-2 px-4 border">YEAR</th>
                  <th class="py-2 px-4 border">MONTH</th>
                  <th class="py-2 px-4 border">ACTIONS</th>
              </tr>
          </thead>
          <tbody id="payrollTableBody" class="text-center">
              <!-- Sample Data -->
              <tr class="hover:bg-gray-50">
                  <td class="border py-2 px-4">1</td>
                  <td class="border py-2 px-4">OFFICER</td>
                  <td class="border py-2 px-4">2025</td>
                  <td class="border py-2 px-4">08</td>
                  <td class="border py-2 px-4 space-x-2">
                      <button class="text-blue-600 hover:underline editBtn">Edit</button> |
                      <button class="text-red-600 hover:underline deleteBtn">Delete</button>
                      <button class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 toggleBtn" data-status="active">
                          Active
                      </button>
                  </td>
              </tr>
              <tr class="hover:bg-gray-50">
                  <td class="border py-2 px-4">2</td>
                  <td class="border py-2 px-4">W/OFFICER</td>
                  <td class="border py-2 px-4">2025</td>
                  <td class="border py-2 px-4">08</td>
                  <td class="border py-2 px-4 space-x-2">
                      <button class="text-blue-600 hover:underline editBtn">Edit</button> |
                      <button class="text-red-600 hover:underline deleteBtn">Delete</button>
                      <button class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 toggleBtn" data-status="active">
                          Active
                      </button>
                  </td>
              </tr>
              <tr class="hover:bg-gray-50">
                  <td class="border py-2 px-4">3</td>
                  <td class="border py-2 px-4">RATE A</td>
                  <td class="border py-2 px-4">2025</td>
                  <td class="border py-2 px-4">07</td>
                  <td class="border py-2 px-4 space-x-2">
                      <button class="text-blue-600 hover:underline editBtn">Edit</button> |
                      <button class="text-red-600 hover:underline deleteBtn">Delete</button>
                      <button class="bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 toggleBtn" data-status="inactive">
                          Inactive
                      </button>
                  </td>
              </tr>
          </tbody>
      </table>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center hidden">
  <div class="bg-white rounded-lg shadow-lg p-6 w-96">
      <h3 class="text-lg font-semibold mb-4 text-gray-800">Confirm Delete</h3>
      <p class="text-gray-600 mb-6">Are you sure you want to delete this payroll class?</p>
      <div class="flex justify-end space-x-3">
          <button id="cancelDeleteBtn" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
          <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Delete</button>
      </div>
  </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm hidden">
  <div class="bg-white rounded-lg shadow-lg p-6 w-80 text-center">
      <div id="spinner" class="mx-auto mb-4 w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
      <div id="checkmark" class="hidden mx-auto mb-4 text-green-600 text-4xl">✔</div>
      <p id="successMessage" class="text-gray-800 font-medium">Processing...</p>
  </div>
</div>

<script>
  (function () {
      const addBtn = document.getElementById("addPayrollBtn");
      const codeInput = document.getElementById("payrollCode");
      const descInput = document.getElementById("payrollDesc");
      const yearInput = document.getElementById("payrollYear");
      const monthInput = document.getElementById("payrollMonth");
      const tableBody = document.getElementById("payrollTableBody");

      const deleteModal = document.getElementById("deleteModal");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");

      const successModal = document.getElementById("successModal");
      const spinner = document.getElementById("spinner");
      const checkmark = document.getElementById("checkmark");
      const successMessage = document.getElementById("successMessage");

      let rowToDelete = null;
      let nextCode = 4; // Start from 4 since we have sample data 1-3

      // Show success modal (spinner → tick)
      function showSuccess(message) {
          spinner.classList.remove("hidden");
          checkmark.classList.add("hidden");
          successMessage.textContent = "Processing...";
          successModal.classList.remove("hidden");

          setTimeout(() => {
              spinner.classList.add("hidden");
              checkmark.classList.remove("hidden");
              successMessage.textContent = message;
          }, 1000);

          setTimeout(() => {
              successModal.classList.add("hidden");
          }, 2500);
      }

      function createRow(code, desc, year, month) {
          const tr = document.createElement("tr");
          tr.className = "hover:bg-gray-50";

          tr.innerHTML = `
              <td class="border py-2 px-4">${code}</td>
              <td class="border py-2 px-4">${desc}</td>
              <td class="border py-2 px-4">${year}</td>
              <td class="border py-2 px-4">${month}</td>
              <td class="border py-2 px-4 space-x-2">
                  <button class="text-blue-600 hover:underline editBtn">Edit</button> |
                  <button class="text-red-600 hover:underline deleteBtn">Delete</button>
                  <button class="bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 toggleBtn" data-status="active">
                      Active
                  </button>
              </td>
          `;

          // Edit inline
          tr.querySelector(".editBtn").addEventListener("click", (e) => {
              const editBtn = e.target;
              const codeCell = tr.children[0];
              const descCell = tr.children[1];
              const yearCell = tr.children[2];
              const monthCell = tr.children[3];

              if (editBtn.textContent === "Edit") {
                  const currentCode = codeCell.textContent;
                  const currentDesc = descCell.textContent;
                  const currentYear = yearCell.textContent;
                  const currentMonth = monthCell.textContent;

                  codeCell.innerHTML = `<input type="text" value="${currentCode}" class="border px-2 py-1 rounded w-full"/>`;
                  descCell.innerHTML = `<input type="text" value="${currentDesc}" class="border px-2 py-1 rounded w-full"/>`;
                  yearCell.innerHTML = `<select class="border px-2 py-1 rounded w-full">
                      <option value="2024" ${currentYear === '2024' ? 'selected' : ''}>2024</option>
                      <option value="2025" ${currentYear === '2025' ? 'selected' : ''}>2025</option>
                      <option value="2026" ${currentYear === '2026' ? 'selected' : ''}>2026</option>
                  </select>`;
                  monthCell.innerHTML = `<select class="border px-2 py-1 rounded w-full">
                      <option value="01" ${currentMonth === '01' ? 'selected' : ''}>01</option>
                      <option value="02" ${currentMonth === '02' ? 'selected' : ''}>02</option>
                      <option value="03" ${currentMonth === '03' ? 'selected' : ''}>03</option>
                      <option value="04" ${currentMonth === '04' ? 'selected' : ''}>04</option>
                      <option value="05" ${currentMonth === '05' ? 'selected' : ''}>05</option>
                      <option value="06" ${currentMonth === '06' ? 'selected' : ''}>06</option>
                      <option value="07" ${currentMonth === '07' ? 'selected' : ''}>07</option>
                      <option value="08" ${currentMonth === '08' ? 'selected' : ''}>08</option>
                      <option value="09" ${currentMonth === '09' ? 'selected' : ''}>09</option>
                      <option value="10" ${currentMonth === '10' ? 'selected' : ''}>10</option>
                      <option value="11" ${currentMonth === '11' ? 'selected' : ''}>11</option>
                      <option value="12" ${currentMonth === '12' ? 'selected' : ''}>12</option>
                  </select>`;

                  const inputs = tr.querySelectorAll("input, select");
                  inputs.forEach(input =>
                      input.addEventListener("keydown", (ev) => {
                          if (ev.key === "Enter") {
                              editBtn.click();
                          }
                      })
                  );

                  editBtn.textContent = "Save";
              } else {
                  const newCode = codeCell.querySelector("input").value.trim();
                  const newDesc = descCell.querySelector("input").value.trim();
                  const newYear = yearCell.querySelector("select").value;
                  const newMonth = monthCell.querySelector("select").value;

                  if (!newCode || !newDesc || !newYear || !newMonth) {
                      alert("All fields are required");
                      return;
                  }

                  codeCell.textContent = newCode;
                  descCell.textContent = newDesc;
                  yearCell.textContent = newYear;
                  monthCell.textContent = newMonth;
                  editBtn.textContent = "Edit";

                  showSuccess("Updated Successfully");
              }
          });

          // Delete
          tr.querySelector(".deleteBtn").addEventListener("click", () => {
              rowToDelete = tr;
              deleteModal.classList.remove("hidden");
          });

          // Toggle Active/Inactive
          tr.querySelector(".toggleBtn").addEventListener("click", (e) => {
              const btn = e.target;
              if (btn.dataset.status === "active") {
                  btn.textContent = "Inactive";
                  btn.className = "bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 toggleBtn";
                  btn.dataset.status = "inactive";
                  showSuccess("Deactivated Successfully");
              } else {
                  btn.textContent = "Active";
                  btn.className = "bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 toggleBtn";
                  btn.dataset.status = "active";
                  showSuccess("Activated Successfully");
              }
          });

          return tr;
      }

      // Add existing sample rows functionality
      document.querySelectorAll('.editBtn').forEach((btn, index) => {
          btn.addEventListener('click', (e) => {
              const tr = btn.closest('tr');
              const editBtn = e.target;
              const codeCell = tr.children[0];
              const descCell = tr.children[1];
              const yearCell = tr.children[2];
              const monthCell = tr.children[3];

              if (editBtn.textContent === "Edit") {
                  const currentCode = codeCell.textContent;
                  const currentDesc = descCell.textContent;
                  const currentYear = yearCell.textContent;
                  const currentMonth = monthCell.textContent;

                  codeCell.innerHTML = `<input type="text" value="${currentCode}" class="border px-2 py-1 rounded w-full"/>`;
                  descCell.innerHTML = `<input type="text" value="${currentDesc}" class="border px-2 py-1 rounded w-full"/>`;
                  yearCell.innerHTML = `<select class="border px-2 py-1 rounded w-full">
                      <option value="2024" ${currentYear === '2024' ? 'selected' : ''}>2024</option>
                      <option value="2025" ${currentYear === '2025' ? 'selected' : ''}>2025</option>
                      <option value="2026" ${currentYear === '2026' ? 'selected' : ''}>2026</option>
                  </select>`;
                  monthCell.innerHTML = `<select class="border px-2 py-1 rounded w-full">
                      <option value="01" ${currentMonth === '01' ? 'selected' : ''}>01</option>
                      <option value="02" ${currentMonth === '02' ? 'selected' : ''}>02</option>
                      <option value="03" ${currentMonth === '03' ? 'selected' : ''}>03</option>
                      <option value="04" ${currentMonth === '04' ? 'selected' : ''}>04</option>
                      <option value="05" ${currentMonth === '05' ? 'selected' : ''}>05</option>
                      <option value="06" ${currentMonth === '06' ? 'selected' : ''}>06</option>
                      <option value="07" ${currentMonth === '07' ? 'selected' : ''}>07</option>
                      <option value="08" ${currentMonth === '08' ? 'selected' : ''}>08</option>
                      <option value="09" ${currentMonth === '09' ? 'selected' : ''}>09</option>
                      <option value="10" ${currentMonth === '10' ? 'selected' : ''}>10</option>
                      <option value="11" ${currentMonth === '11' ? 'selected' : ''}>11</option>
                      <option value="12" ${currentMonth === '12' ? 'selected' : ''}>12</option>
                  </select>`;

                  editBtn.textContent = "Save";
              } else {
                  const newCode = codeCell.querySelector("input").value.trim();
                  const newDesc = descCell.querySelector("input").value.trim();
                  const newYear = yearCell.querySelector("select").value;
                  const newMonth = monthCell.querySelector("select").value;

                  if (!newCode || !newDesc || !newYear || !newMonth) {
                      alert("All fields are required");
                      return;
                  }

                  codeCell.textContent = newCode;
                  descCell.textContent = newDesc;
                  yearCell.textContent = newYear;
                  monthCell.textContent = newMonth;
                  editBtn.textContent = "Edit";

                  showSuccess("Updated Successfully");
              }
          });
      });

      // Delete functionality for sample rows
      document.querySelectorAll('.deleteBtn').forEach(btn => {
          btn.addEventListener('click', () => {
              rowToDelete = btn.closest('tr');
              deleteModal.classList.remove("hidden");
          });
      });

      // Toggle functionality for sample rows
      document.querySelectorAll('.toggleBtn').forEach(btn => {
          btn.addEventListener('click', (e) => {
              const toggleBtn = e.target;
              if (toggleBtn.dataset.status === "active") {
                  toggleBtn.textContent = "Inactive";
                  toggleBtn.className = "bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600 toggleBtn";
                  toggleBtn.dataset.status = "inactive";
                  showSuccess("Deactivated Successfully");
              } else {
                  toggleBtn.textContent = "Active";
                  toggleBtn.className = "bg-green-500 text-white px-3 py-1 rounded text-xs hover:bg-green-600 toggleBtn";
                  toggleBtn.dataset.status = "active";
                  showSuccess("Activated Successfully");
              }
          });
      });

      // Add new record
      addBtn.addEventListener("click", () => {
          const code = codeInput.value.trim();
          const desc = descInput.value.trim();
          const year = yearInput.value;
          const month = monthInput.value;

          if (!code || !desc || !year || !month) {
              alert("Please fill all fields");
              return;
          }

          tableBody.appendChild(createRow(code, desc, year, month));
          showSuccess("Added Successfully");

          // Clear form
          codeInput.value = "";
          descInput.value = "";
          yearInput.value = "";
          monthInput.value = "";
          nextCode++;
      });

      // Cancel delete
      cancelDeleteBtn.addEventListener("click", () => {
          rowToDelete = null;
          deleteModal.classList.add("hidden");
      });

      // Confirm delete
      confirmDeleteBtn.addEventListener("click", () => {
          if (rowToDelete) {
              rowToDelete.remove();
              rowToDelete = null;
              deleteModal.classList.add("hidden");
              showSuccess("Deleted Successfully");
          }
      });

      // Close modals on outside click
      deleteModal.addEventListener('click', (e) => {
          if (e.target === deleteModal) {
              deleteModal.classList.add("hidden");
              rowToDelete = null;
          }
      });

      successModal.addEventListener('click', (e) => {
          if (e.target === successModal) {
              successModal.classList.add("hidden");
          }
      });
  })();
</script>
