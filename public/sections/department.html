<div class="p-6">
  <!-- Department Section Header -->
  <div class="flex flex-wrap justify-between mb-6">
    <h3 class="text-xl font-semibold text-gray-800">Department Management</h3>
    <div class="flex gap-2">
      <input type="text" id="searchDept" placeholder="Search by ID or Name" class="border rounded px-3 py-2">
      <button id="addNewDeptBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add Department</button>
    </div>
  </div>

  <!-- Hidden Department Form -->
  <form id="deptForm" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Department ID *</label>
      <input type="text" id="deptId" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white" placeholder="Enter ID">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Name *</label>
      <input type="text" id="deptName" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white" placeholder="Enter name">
    </div>
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-gray-700">Description</label>
      <textarea id="deptDesc" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white" placeholder="Enter description"></textarea>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Status</label>
      <select id="deptStatus" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-white">
        <option value="Active">Active</option>
        <option value="Inactive">Inactive</option>
      </select>
    </div>
    <div class="col-span-1 md:col-span-2 flex justify-end gap-2">
      <button type="button" id="saveDeptBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">Save</button>
      <button type="button" id="cancelDeptBtn" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
    </div>
  </form>

  <!-- Department Table -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-blue-100 text-blue-900">
        <tr>
          <th class="border px-2 py-3 text-left">ID</th>
          <th class="border px-2 py-3 text-left">Name</th>
          <th class="border px-2 py-3 text-left">Description</th>
          <th class="border px-2 py-3 text-left">Status</th>
          <th class="border px-2 py-3 text-left">Actions</th>
        </tr>
      </thead>
      <tbody id="deptTableBody"></tbody>
    </table>
  </div>
</div>

<!-- Success Modal -->
<div id="deptSuccessModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-green-600 mb-2">Success!</h3>
    <p id="deptSuccessMessage" class="mb-4 text-gray-700"></p>
    <div class="flex justify-end">
      <button id="closeSuccessModal" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">OK</button>
    </div>
  </div>
</div>

<!-- Error Modal -->
<div id="deptErrorModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-red-600 mb-2">Error</h3>
    <p id="deptErrorMessage" class="mb-4 text-gray-700"></p>
    <div class="flex justify-end">
      <button id="closeErrorModal" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">OK</button>
    </div>
  </div>
</div>

<!-- Confirm Delete Modal -->
<div id="deptConfirmModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl max-w-md w-full mx-4">
    <h3 class="text-lg font-semibold text-yellow-600 mb-2">Confirm Delete</h3>
    <p id="deptConfirmMessage" class="mb-4 text-gray-700">Are you sure you want to delete this department?</p>
    <div class="flex justify-end gap-2">
      <button id="cancelConfirm" class="bg-gray-400 text-white px-4 py-2 rounded hover:bg-gray-500">Cancel</button>
      <button id="deptConfirmAction" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<!-- View Department Modal -->
<div id="deptViewModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
  <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-screen overflow-y-auto">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-blue-600">Department Details</h3>
      <button id="closeViewModal" class="text-gray-400 hover:text-gray-600">
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div id="deptViewContent" class="space-y-3 text-sm"></div>
  </div>
</div>

<script>
  let deptData = [
    { id: "2342", name: "CPO", description: "CENTRAL PAY OFFICE", status: "Active" },
    { id: "2343", name: "MPB", description: "MILITARY PENSION BOARD", status: "Active" }
  ];
  let editingDeptIndex = null;
  let pendingDeleteIndex = null;

  const deptForm = document.getElementById("deptForm");
  const addNewDeptBtn = document.getElementById("addNewDeptBtn");
  const saveDeptBtn = document.getElementById("saveDeptBtn");
  const cancelDeptBtn = document.getElementById("cancelDeptBtn");
  const deptTableBody = document.getElementById("deptTableBody");
  const searchDept = document.getElementById("searchDept");

  addNewDeptBtn.addEventListener("click", () => {
    deptForm.classList.remove("hidden");
    editingDeptIndex = null;
    resetDeptForm();
  });

  saveDeptBtn.addEventListener("click", () => {
    const deptRecord = {
      id: document.getElementById("deptId").value.trim(),
      name: document.getElementById("deptName").value.trim(),
      description: document.getElementById("deptDesc").value.trim(),
      status: document.getElementById("deptStatus").value.trim()
    };
    if (!deptRecord.id || !deptRecord.name) {
      showErrorModal("Please fill in required fields: ID, Name");
      return;
    }
    if (editingDeptIndex !== null) {
      deptData[editingDeptIndex] = deptRecord;
      showSuccessModal("Department updated successfully!");
      editingDeptIndex = null;
    } else {
      deptData.push(deptRecord);
      showSuccessModal("Department saved successfully!");
    }
    renderDeptTable();
    deptForm.classList.add("hidden");
    resetDeptForm();
  });

  cancelDeptBtn.addEventListener("click", () => {
    deptForm.classList.add("hidden");
    resetDeptForm();
    editingDeptIndex = null;
  });

  function resetDeptForm() {
    deptForm.querySelectorAll('input, textarea, select').forEach(el => el.value = "");
  }

  function renderDeptTable(filtered = deptData) {
    deptTableBody.innerHTML = filtered.map((item, index) => `
      <tr class="hover:bg-yellow-50">
        <td class="border px-2 py-3">${item.id}</td>
        <td class="border px-2 py-3">${item.name}</td>
        <td class="border px-2 py-3">${item.description}</td>
        <td class="border px-2 py-3">${item.status}</td>
        <td class="border px-2 py-3">
          <button onclick="viewDept(${index})" class="text-blue-600 hover:text-blue-900 mr-2">View</button>
          <button onclick="editDept(${index})" class="text-green-600 hover:text-green-900 mr-2">Edit</button>
          <button onclick="deleteDept(${index})" class="text-red-600 hover:text-red-900">Delete</button>
        </td>
      </tr>
    `).join("");
  }

  window.viewDept = function(index) {
    const item = deptData[index];
    let html = `
      <div class="grid grid-cols-3 gap-2 py-2 border-b">
        <dt class="font-medium text-gray-600">ID:</dt>
        <dd class="col-span-2 text-gray-900">${item.id}</dd>
      </div>
      <div class="grid grid-cols-3 gap-2 py-2 border-b">
        <dt class="font-medium text-gray-600">Name:</dt>
        <dd class="col-span-2 text-gray-900">${item.name}</dd>
      </div>
      <div class="grid grid-cols-3 gap-2 py-2 border-b">
        <dt class="font-medium text-gray-600">Description:</dt>
        <dd class="col-span-2 text-gray-900">${item.description || "N/A"}</dd>
      </div>
      <div class="grid grid-cols-3 gap-2 py-2 border-b">
        <dt class="font-medium text-gray-600">Status:</dt>
        <dd class="col-span-2 text-gray-900">${item.status}</dd>
      </div>
      <div class="grid grid-cols-3 gap-2 py-2">
        <dt class="font-medium text-gray-600">Command ID:</dt>
        <dd class="col-span-2 text-gray-900">none</dd>
      </div>
      <div class="grid grid-cols-3 gap-2 py-2">
        <dt class="font-medium text-gray-600">LandSea:</dt>
        <dd class="col-span-2 text-gray-900">none</dd>
      </div>
    `;
    document.getElementById("deptViewContent").innerHTML = html;
    showModal("deptViewModal");
  };

  window.editDept = function(index) {
    const item = deptData[index];
    document.getElementById("deptId").value = item.id;
    document.getElementById("deptName").value = item.name;
    document.getElementById("deptDesc").value = item.description;
    document.getElementById("deptStatus").value = item.status;
    editingDeptIndex = index;
    deptForm.classList.remove("hidden");
  };

  window.deleteDept = function(index) {
    pendingDeleteIndex = index;
    showModal("deptConfirmModal");
  };

  document.getElementById("deptConfirmAction").addEventListener("click", () => {
    if (pendingDeleteIndex !== null) {
      deptData.splice(pendingDeleteIndex, 1);
      renderDeptTable();
      showSuccessModal("Department deleted successfully!");
      pendingDeleteIndex = null;
    }
    closeModal("deptConfirmModal");
  });

  function showModal(modalId) {
    document.getElementById(modalId).classList.remove("hidden");
  }
  function closeModal(modalId) {
    document.getElementById(modalId).classList.add("hidden");
  }
  function showSuccessModal(msg) {
    document.getElementById("deptSuccessMessage").textContent = msg;
    showModal("deptSuccessModal");
  }
  function showErrorModal(msg) {
    document.getElementById("deptErrorMessage").textContent = msg;
    showModal("deptErrorModal");
  }

  function showConfirmModal(message) {
    document.getElementById("deptConfirmMessage").textContent = message;
    showModal("deptConfirmModal");
  }

    // Modal event listeners
  document.getElementById("closeSuccessModal").addEventListener("click", () => closeModal("deptSuccessModal"));
  document.getElementById("closeErrorModal").addEventListener("click", () => closeModal("deptErrorModal"));
  document.getElementById("closeViewModal").addEventListener("click", () => closeModal("deptViewModal"));
  document.getElementById("cancelConfirm").addEventListener("click", () => {
    closeModal("deptConfirmModal");
    pendingDeleteIndex = null;
  });

  searchDept.addEventListener("input", () => {
    const query = searchDept.value.toLowerCase();
    const filtered = deptData.filter(item =>
      item.id.toLowerCase().includes(query) || item.name.toLowerCase().includes(query)
    );
    renderDeptTable(filtered);
  });

    // Close modals when clicking outside
  const modals = ['deptSuccessModal', 'deptErrorModal', 'deptConfirmModal', 'deptViewModal'];
  modals.forEach(modalId => {
    document.getElementById(modalId).addEventListener("click", (e) => {
      if (e.target === e.currentTarget) closeModal(modalId);
    });
  });


  renderDeptTable();
</script>
