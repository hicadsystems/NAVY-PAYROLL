<!-- TABS -->
<div class="p-6">
  <div class="flex flex-wrap justify-between bg-white/50 rounded-xl border border-amber-50 shadow-sm p-2 gap-2">
    <div class="flex flex-wrap justify-start gap-2">
      <button type="button" id="tab-batch" class="px-4 py-2 rounded-md bg-yellow-400 text-grey hover:bg-blue-600">
        Batch Upload
      </button>
    </div>
    <div class="flex flex-wrap justify-end gap-2">
      <button id="tab-personnel" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-600">Personnel</button>
      <button id="tab-nok" class="px-4 py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600">NOK</button>
      <button id="tab-spouse" class="px-4 py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600">Spouse</button>
      <button id="tab-children" class="px-4 py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600">Children</button>
    </div>
  </div>
</div>

<!-- BATCH UPLOAD SECTION -->
<div id="section-batch" class="p-6 flex justify-center">
  <div class="w-full max-w-lg rounded-2xl p-6">
    <h3 class="text-2xl font-bold text-blue-800 mb-4">Batch Upload</h3>
    
    <form id="batchUploadForm" class="space-y-6">
      <!-- File Upload -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Upload File</label>
        <input type="file" id="batchFile" 
               class="mt-1 block w-full border border-blue-500 bg-white rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
        <p class="text-xs text-gray-500 mt-2">
          Only .xlsx or .csv files allowed. 
          <a href="sample.csv" download 
             class="text-blue-600 hover:underline ml-2">Download Sample</a>
        </p>
      </div>

      <!-- Buttons -->
      <div class="flex justify-end space-x-4">
        <button type="button" id="cancelBatchBtn"
          class="px-6 py-2 bg-gray-400 hover:bg-gray-500 rounded-lg text-white">Cancel</button>
        <button type="button" id="uploadBatchBtn"
          class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">Upload</button>
      </div>
    </form>
  </div>
</div>

<!-- SUCCESS POPUP -->
<div id="uploadSuccessPopup" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-40 z-50">
  <div class="bg-white rounded-2xl shadow-lg p-6 w-96 text-center">
    <h4 class="text-xl font-semibold text-green-600 mb-2">Upload Successful!</h4>
    <p class="text-gray-600 mb-4">Your batch file has been uploaded successfully.</p>
    <button id="closePopupBtn" 
      class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg">Close</button>
  </div>
</div>

<!-- PERSONNEL SECTION -->
<div id="section-personnel" class="px-6 mb-4">
  <!-- Title -->
  <h3 id="formTitle" class="hidden text-2xl font-bold text-blue-800 mb-4"></h3>

  <!-- Step Buttons + Current Personnel -->
  <div class="flex flex-wrap items-center gap-2 justify-between mb-4">
    <div class=" flex flex-wrap gap-2 items-center">
      <button id="btnStep1" class="relative px-4 text-sm lg:text-lg py-2 rounded-md bg-blue-600 hover:bg-blue-600 text-white transition-all overflow-hidden group">
        <span class="relative z-10">Step 1: Basic Details</span>
      </button>
      <button id="btnStep2" class="relative px-4 text-sm lg:text-lg py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600 transition-all overflow-hidden group">
        <span class="relative z-10">Step 2: Official Info</span>
      </button>
      <button id="btnStep3" class="relative px-4 text-sm lg:text-lg py-2 rounded-md bg-yellow-400 text-gray-900 hover:bg-blue-600 transition-all overflow-hidden group">
        <span class="relative z-10">Step 3: Additional Info</span>
      </button>
    </div>

    <button onclick="window.navigation?.navigateToSection ? window.navigation.navigateToSection('current-personnel','Current Personnel') : alert('Hook your navigation here.')"
      class="px-4 text-sm lg:text-lg py-2 bg-green-600 text-white rounded-md hover:bg-green-700">
      Current Personnel
    </button>
  </div>

  <!-- Form -->
  <form id="personnelForm" class="space-y-6">
    <!-- Step 1 (dynamic, with labels) -->
    <div id="step1" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>

    <!-- Step 2 (static, with labels) -->
    <div id="step2" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Date Joined</label>
        <input type="date" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date Commissioned</label>
        <input type="date" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Entry Mode</label>
        <input type="text" placeholder="Entry Mode" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date Left</label>
        <input type="date" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Exit Mode</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Exit Mode</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Taxed ?</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">TaxID No(TIN)</label>
        <input type="text" placeholder="TaxID N0" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Tax State</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Tax State</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">RSA(Pension) Code</label>
        <input type="text" placeholder="RSA(Pension) Code" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Pension Fund Administrator</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Administrator</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Payroll Process Category</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Payroll Process</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Salary Group</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Salary Group</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Salary Grade</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Salary Grade</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Bank Branch</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Bank Branch</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Account Number</label>
        <input type="text" placeholder="Account Number" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
    </div>

    <!-- Step 3 (static, with labels) -->
    <div id="step3" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Senority Date</label>
        <input type="date" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Ship/Establishment</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>select</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Branch</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Branch</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Command</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Command</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Specialization</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Specialization</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Present Appointment</label>
        <input type="text" placeholder="Present Appointment" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Award/Decoration</label>
        <input type="text" placeholder="Award/Decoration" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Emolument Form Received?</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">NHF Code</label>
        <input type="text" placeholder="NHF Code" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Bank Code</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Bank Code</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">IPPIS NO</label>
        <input type="text" placeholder="IPPIS NO" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Country</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Country</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Accommodation Type</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select Accommodation Type</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Rent Subsidy</label>
        <select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Select</option>
        </select>
      </div>
    </div>

    <!-- Actions -->
    <div class="col-span-full flex justify-end space-x-4 pt-4">
      <button type="button" id="cancelBtn" class="px-6 py-2 bg-gray-400 hover:bg-gray-500 rounded-lg text-white">Cancel</button>
      <button type="button" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg text-white">Submit</button>
    </div>
  </form>
</div>

<!-- NOK SECTION -->
<div id="section-nok" class="hidden p-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-2xl font-bold text-blue-800">Next of Kin</h3>
    <button id="nokToggleBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">+ Add</button>
  </div>

  <!-- Form -->
  <div id="nokFormWrap" class="hidden">
    <form id="nokForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">First Name <span class="text-red-500">*</span></label>
        <input id="nokFirst" required type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Last Name <span class="text-red-500">*</span></label>
        <input id="nokLast" required type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
        <input id="nokDob" type="date" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Full Address <span class="text-red-500">*</span></label>
        <input id="nokAddress" required type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Relationship <span class="text-red-500">*</span></label>
        <select id="nokRelationship" required class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option value="">Select</option>
          <option>Spouse</option><option>Father</option><option>Mother</option>
          <option>Son</option><option>Daughter</option><option>Brother</option>
          <option>Sister</option><option>Uncle</option><option>Aunt</option><option>Friend</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Mobile Number <span class="text-red-500">*</span></label>
        <input id="nokMobile" required type="tel" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Home Number</label>
        <input id="nokHome" type="tel" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email Address <span class="text-red-500">*</span></label>
        <input id="nokEmail" required type="email" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Place Of Work</label>
        <input id="nokWork" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Next Of Kin Type</label>
        <select id="nokType" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:outline-none focus:ring-2 focus:ring-yellow-500">
          <option>Main</option><option>Alternate</option>
        </select>
      </div>
    </form>
    <div class="flex justify-end gap-3 mb-6">
      <button id="nokCancel" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Cancel</button>
      <button id="nokSave" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
    </div>
  </div>

  <!-- List -->
  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-blue-100 text-blue-900">
        <tr>
          <th class="py-2 px-3 border">Name</th>
          <th class="py-2 px-3 border">Relationship</th>
          <th class="py-2 px-3 border">Mobile</th>
          <th class="py-2 px-3 border">Email</th>
          <th class="py-2 px-3 border">Actions</th>
        </tr>
      </thead>
      <tbody id="nokList" class="text-center">
        <tr id="nokEmpty"><td colspan="4" class="py-4 text-gray-500">No NOKs yet.</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- SPOUSE SECTION -->
<div id="section-spouse" class="hidden p-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-2xl font-bold text-blue-800">Spouse</h3>
    <button id="spouseToggleBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">+ Add</button>
  </div>

  <div id="spouseFormWrap" class="hidden">
    <form id="spouseForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Full Name <span class="text-red-500">*</span></label>
        <input id="spouseName" required type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date Of Birth</label>
        <input id="spouseDob" type="date" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date of Married</label>
        <input id="spouseDom" type="date" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Street</label>
        <input id="spouseStreet" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Town</label>
        <input id="spouseTown" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">State</label>
        <input id="spouseState" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Local Government</label>
        <input id="spouseLga" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Phone</label>
        <input id="spousePhone" type="tel" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email</label>
        <input id="spouseEmail" type="email" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">P.O Box</label>
        <input id="spousePoBox" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
    </form>
    <div class="flex justify-end gap-3 mb-6">
      <button id="spouseCancel" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Cancel</button>
      <button id="spouseSave" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-blue-100 text-blue-900">
        <tr>
          <th class="py-2 px-3 border">Full Name</th>
          <th class="py-2 px-3 border">Phone</th>
          <th class="py-2 px-3 border">Email</th>
          <th class="py-2 px-3 border">Actions</th>
        </tr>
      </thead>
      <tbody id="spouseList" class="text-center">
        <tr id="spouseEmpty"><td colspan="3" class="py-4 text-gray-500">No spouse records yet.</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- CHILDREN SECTION -->
<div id="section-children" class="hidden p-6">
  <div class="flex items-center justify-between mb-4">
    <h3 class="text-2xl font-bold text-blue-800">Children</h3>
    <button id="childToggleBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700">+ Add</button>
  </div>

  <div id="childFormWrap" class="hidden">
    <form id="childForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Full Name <span class="text-red-500">*</span></label>
        <input id="childName" required type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Street</label>
        <input id="childStreet" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Town</label>
        <input id="childTown" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">State</label>
        <input id="childState" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Local Government</label>
        <input id="childLga" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Phone</label>
        <input id="childPhone" type="tel" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email</label>
        <input id="childEmail" type="email" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">P.O Box</label>
        <input id="childPoBox" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Sex</label>
        <select id="childSex" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none">
          <option value="">Select</option><option>Male</option><option>Female</option><option>Other</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Date of Birth</label>
        <input id="childDob" type="date" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">School</label>
        <input id="childSchool" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Office Address</label>
        <input id="childOffice" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
      <div >
        <label class="block text-sm font-medium text-gray-700">Occupation</label>
        <input id="childOccupation" type="text" class="w-full border border-blue-500 rounded-md px-3 py-2 bg-transparent focus:ring-2 focus:ring-yellow-500 focus:outline-none" />
      </div>
    </form>
    <div class="flex justify-end gap-3 mb-6">
      <button id="childCancel" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Cancel</button>
      <button id="childSave" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">Save</button>
    </div>
  </div>

  <div class="overflow-x-auto">
    <table class="min-w-full border border-gray-200 rounded-lg text-sm">
      <thead class="bg-blue-100 text-blue-900">
        <tr>
          <th class="py-2 px-3 border">Full Name</th>
          <th class="py-2 px-3 border">Sex</th>
          <th class="py-2 px-3 border">DOB</th>
          <th class="py-2 px-3 border">Phone</th>
          <th class="py-2 px-3 border">Actions</th>
        </tr>
      </thead>
      <tbody id="childList" class="text-center">
        <tr id="childEmpty"><td colspan="4" class="py-4 text-gray-500">No children yet.</td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Action Popup -->
<div id="actionPopup" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
  <div class="bg-white p-6 rounded-2xl shadow-xl text-center w-64">
    <div id="popupIcon" class="mx-auto h-12 w-12 rounded-full border-4 border-blue-500 border-t-transparent animate-spin"></div>
    <p id="popupText" class="mt-4 text-lg font-semibold text-gray-700">Processing...</p>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
  <div class="bg-white rounded-2xl shadow-xl w-96 p-6">
    <h3 class="text-xl font-semibold text-red-600 mb-4">Confirm Delete</h3>
    <p class="text-gray-700 mb-6">Are you sure you want to delete this record?</p>
    <div class="flex justify-end gap-3">
      <button id="deleteCancelBtn" class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400">Cancel</button>
      <button id="deleteConfirmBtn" class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700">Delete</button>
    </div>
  </div>
</div>

<script>
// Global variables and helper functions
let nokCounter = 0;
let spouseCounter = 0;
let childCounter = 0;
const editState = { type: null, id: null, row: null };

// Helper functions
function val(id) { 
  return (document.getElementById(id)?.value || '').trim(); 
}

function escapeHtml(s) { 
  return String(s).replace(/[&<>"']/g, m => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#039;'
  }[m])); 
}

function toggleBlock(el, btn) {
  const isHidden = el.classList.contains('hidden');
  el.classList.toggle('hidden');
  btn.textContent = isHidden ? '−' : '+ Add';
}

function showPopup(message) {
  const popup = document.getElementById('actionPopup');
  const icon = document.getElementById('popupIcon');
  const text = document.getElementById('popupText');

  // Reset to spinner
  icon.className = "mx-auto h-12 w-12 rounded-full border-4 border-blue-500 border-t-transparent animate-spin";
  text.textContent = message;
  popup.classList.remove('hidden');

  setTimeout(() => {
    icon.className = "mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-500 text-white";
    icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                      </svg>`;
    text.textContent = "Success!";
    setTimeout(() => {
      popup.classList.add('hidden');
      icon.innerHTML = "";
    }, 1000);
  }, 1500);
}

function actionBtns(type, id) {
  return `
    <button onclick="viewRow('${type}', ${id})" class="px-2 text-blue-600 hover:underline">View</button>
    <button onclick="editRow('${type}', ${id})" class="px-2 text-green-600 hover:underline">Edit</button>
    <button onclick="deleteRow(this)" class="px-2 text-red-600 hover:underline">Delete</button>
  `;
}

// Global functions for row actions
window.viewRow = (t,i)=>showPopup(`Viewing ${t} #${i}`);

let deleteTargetRow = null; // store which row to delete

window.deleteRow = function(btn){
  deleteTargetRow = btn.closest('tr');
  document.getElementById('deleteModal').classList.remove('hidden');
};

// modal button events
document.getElementById('deleteCancelBtn').onclick = () => {
  deleteTargetRow = null;
  document.getElementById('deleteModal').classList.add('hidden');
};

document.getElementById('deleteConfirmBtn').onclick = () => {
  if(deleteTargetRow){
    deleteTargetRow.remove();
    deleteTargetRow = null;
    showPopup("Deleting Record...");
  }
  document.getElementById('deleteModal').classList.add('hidden');
};

window.editRow = function(type, id) {
  const row = document.querySelector(`tr[data-type="${type}"][data-id="${id}"]`);
  if (!row) {
    console.error("Row not found:", type, id);
    return;
  }
  
  editState.type = type;
  editState.id = id;
  editState.row = row;
  const cells = row.querySelectorAll('td');

  if(type==="NOK"){
    const [first,last=""] = cells[0].textContent.split(" ");
    document.getElementById('nokFirst').value = first;
    document.getElementById('nokLast').value  = last;
    document.getElementById('nokRelationship').value = cells[1].textContent;
    document.getElementById('nokMobile').value = cells[2].textContent;
    document.getElementById('nokEmail').value  = cells[3].textContent;

   // Show form
    const wrap = document.getElementById('nokFormWrap');
    const btn = document.getElementById('nokToggleBtn');
    wrap.classList.remove('hidden');
    btn.textContent = "−";
  }

  if(type==="Spouse"){
    document.getElementById('spouseName').value   = cells[0].textContent;
    document.getElementById('spousePhone').value  = cells[1].textContent;
    document.getElementById('spouseEmail').value  = cells[2].textContent;

    // Show form
    const wrap = document.getElementById('spouseFormWrap');
    const btn = document.getElementById('spouseToggleBtn');
    wrap.classList.remove('hidden');
    btn.textContent = "−";
  }

  if (type === "Child") {
    document.getElementById('childName').value   = cells[0].textContent;
    document.getElementById('childSex').value    = cells[1].textContent;
    document.getElementById('childDob').value    = cells[2].textContent;
    document.getElementById('childPhone').value  = cells[3].textContent;
    
    // Show form
    const wrap = document.getElementById('childFormWrap');
    const btn = document.getElementById('childToggleBtn');
    wrap.classList.remove('hidden');
    btn.textContent = '−';
  }
};

// Batch Upload functionality
const uploadBtn = document.getElementById("uploadBatchBtn");
const popup = document.getElementById("uploadSuccessPopup");
const closePopupBtn = document.getElementById("closePopupBtn");
const cancelBtn = document.getElementById("cancelBatchBtn");

uploadBtn.addEventListener("click", () => {
  const fileInput = document.getElementById("batchFile");
  if (!fileInput.files.length) {
    alert("Please select a file to upload!");
    return;
  }

  uploadBtn.innerText = "Uploading...";
  uploadBtn.disabled = true;
  setTimeout(() => {
    uploadBtn.innerText = "Upload";
    uploadBtn.disabled = false;
    popup.classList.remove("hidden");
  }, 2000);
});

closePopupBtn.addEventListener("click", () => {
  popup.classList.add("hidden");
  document.getElementById("batchUploadForm").reset();
});

cancelBtn.addEventListener("click", () => {
  document.getElementById("batchUploadForm").reset();
});

// Tab functionality
const tabs = ['personnel', 'nok', 'spouse', 'children', 'batch'];

function showTab(name) {
  tabs.forEach(t => {
    const tabBtn = document.getElementById('tab-' + t);
    const section = document.getElementById('section-' + t);
    
    tabBtn.classList.remove('bg-blue-600', 'text-white');
    tabBtn.classList.add('bg-yellow-400', 'text-gray-900');
    section.classList.add('hidden');
  });
  
  const activeTab = document.getElementById('tab-' + name);
  const activeSection = document.getElementById('section-' + name);
  
  activeTab.classList.add('bg-blue-600', 'text-white');
  activeTab.classList.remove('bg-yellow-400', 'text-gray-900');
  activeSection.classList.remove('hidden');
}

// Set up tab click handlers
document.getElementById('tab-personnel').onclick = () => showTab('personnel');
document.getElementById('tab-nok').onclick = () => showTab('nok');
document.getElementById('tab-spouse').onclick = () => showTab('spouse');
document.getElementById('tab-children').onclick = () => showTab('children');
document.getElementById('tab-batch').onclick = () => showTab('batch');

// Default to personnel tab
showTab('personnel');

// Personnel form functionality
const formTitle = "Add New Personnel";
const fieldsStep1 = [
  "Service Number", "Rank", "Surname", "Other Names", "Date of Birth", "Town", "Residential Address", "Email Address", "GSM Number", "Sex", "Marital Status", "Religion", "State Of Origin", "Local Government", "Passport Photograph"
];

const step1Container = document.getElementById("step1");
const step2Container = document.getElementById("step2");
const step3Container = document.getElementById("step3");
const btnStep1 = document.getElementById("btnStep1");
const btnStep2 = document.getElementById("btnStep2");
const btnStep3 = document.getElementById("btnStep3");
const formTitleEl = document.getElementById("formTitle");
const personnelCancelBtn = document.getElementById("cancelBtn");

function controlWrap(label, control) {
  return `<div><label class="block text-sm font-medium text-gray-700">${label}</label>${control}</div>`;
}

function renderStep1() {
  step1Container.innerHTML = fieldsStep1.map(field => {
    if (["Rank", "Religion", "Tribe", "State Of Origin", "Local Government", "Last Location", "Sex", "Marital Status", "Last Location", "Directorate", "Geo Political Zone"].includes(field)) {
      return controlWrap(field,
        `<select class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500">
           <option>Select ${field}</option>
         </select>`);
    }
    if (field === "Passport Photograph") {
      return controlWrap(field,
        `<input type="file" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"/>`);
    }
    if (field === "Date of Birth") {
      return controlWrap(field,
        `<input type="date" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"/>`);
    }
    return controlWrap(field,
      `<input type="text" placeholder="${field}" class="w-full border border-blue-500 bg-transparent rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-500"/>`);
  }).join("");
}

function toggleStep(step) {
  if (step === 1) {
    step1Container.classList.remove("hidden");
    step2Container.classList.add("hidden");
    step3Container.classList.add("hidden");
    btnStep1.classList.add("bg-blue-600", "text-white");
    btnStep1.classList.remove("bg-yellow-400", "text-gray-900");
    btnStep2.classList.add("bg-yellow-400", "text-gray-900");
    btnStep2.classList.remove("bg-blue-600", "text-white");
    btnStep3.classList.add("bg-yellow-400", "text-gray-900");
    btnStep3.classList.remove("bg-blue-600", "text-white");
  } else if (step === 2) {
    step1Container.classList.add("hidden");
    step2Container.classList.remove("hidden");
    step3Container.classList.add("hidden");
    btnStep2.classList.add("bg-blue-600", "text-white");
    btnStep2.classList.remove("bg-yellow-400", "text-gray-900");
    btnStep1.classList.add("bg-yellow-400", "text-gray-900");
    btnStep1.classList.remove("bg-blue-600", "text-white");
    btnStep3.classList.add("bg-yellow-400", "text-gray-900");
    btnStep3.classList.remove("bg-blue-600", "text-white");
  } else {
    step1Container.classList.add("hidden");
    step2Container.classList.add("hidden");
    step3Container.classList.remove("hidden");
    btnStep3.classList.add("bg-blue-600", "text-white");
    btnStep3.classList.remove("bg-yellow-400", "text-gray-900");
    btnStep2.classList.add("bg-yellow-400", "text-gray-900");
    btnStep2.classList.remove("bg-blue-600", "text-white");
    btnStep1.classList.add("bg-yellow-400", "text-gray-900");
    btnStep1.classList.remove("bg-blue-600", "text-white");
  }
}

function cancelPersonnelForm() {
  document.getElementById("personnelForm").reset();
  toggleStep(1);
}

// Initialize personnel form
formTitleEl.textContent = formTitle;
renderStep1();
toggleStep(1);

btnStep1.addEventListener("click", () => toggleStep(1));
btnStep2.addEventListener("click", () => toggleStep(2));
btnStep3.addEventListener("click", () => toggleStep(3));
personnelCancelBtn.addEventListener("click", cancelPersonnelForm);

// NOK functionality
const nokFormWrap = document.getElementById('nokFormWrap');
const nokToggleBtn = document.getElementById('nokToggleBtn');
const nokSaveBtn = document.getElementById('nokSave');
const nokCancelBtn = document.getElementById('nokCancel');

nokToggleBtn.onclick = () => toggleBlock(nokFormWrap, nokToggleBtn);

nokCancelBtn.onclick = () => {
  document.getElementById('nokForm').reset();
  editState.type = null;
  editState.row = null;
  toggleBlock(nokFormWrap, nokToggleBtn);
};

nokSaveBtn.onclick = () => {
  const first = val('nokFirst');
  const last = val('nokLast');
  const rel = val('nokRelationship');
  const mobile = val('nokMobile');
  const email = val('nokEmail');

  if (!first || !last || !rel || !mobile || !email) {
    alert('Please fill all required fields');
    return;
  }

  const list = document.getElementById('nokList');
  const empty = document.getElementById('nokEmpty');
  if (empty) empty.remove();

  if(editState.type==="NOK" && editState.row){
    // Update existing row
    const cells = editState.row.querySelectorAll('td');
    cells[0].textContent = `${first} ${last}`;
    cells[1].textContent = rel;
    cells[2].textContent = mobile;
    cells[3].textContent = email;
    editState.type = null;
    editState.row = null; 
    showPopup("Updating NOK");
  }else{
    nokCounter++;
    list.insertAdjacentHTML('beforeend',`
      <tr data-type="NOK" data-id="${nokCounter}" class="hover:bg-yellow-50">
        <td class="border px-3 py-2">${escapeHtml(first)} ${escapeHtml(last)}</td>
        <td class="border px-3 py-2">${escapeHtml(rel)}</td>
        <td class="border px-3 py-2">${escapeHtml(mobile)}</td>
        <td class="border px-3 py-2">${escapeHtml(email)}</td>
        <td class="border px-3 py-2">${actionBtns('NOK', nokCounter)}</td>
      </tr>`);
    showPopup("Saving NOK");
  }

  document.getElementById('nokForm').reset();
  toggleBlock(nokFormWrap, nokToggleBtn);
};

// Spouse functionality
const spouseFormWrap = document.getElementById('spouseFormWrap');
const spouseToggleBtn = document.getElementById('spouseToggleBtn');
const spouseSaveBtn = document.getElementById('spouseSave');
const spouseCancelBtn = document.getElementById('spouseCancel');

spouseToggleBtn.onclick = () => toggleBlock(spouseFormWrap, spouseToggleBtn);

spouseCancelBtn.onclick = () => {
  document.getElementById('spouseForm').reset();
  editState.type = null;
  editState.row = null;
  toggleBlock(spouseFormWrap, spouseToggleBtn);
};

spouseSaveBtn.onclick = () => {
  const name = val('spouseName');
  const phone = val('spousePhone');
  const email = val('spouseEmail');

  if (!name) {
    alert('Full Name is required');
    return;
  }

  const list = document.getElementById('spouseList');
  const empty = document.getElementById('spouseEmpty');
  if (empty) empty.remove();

  if(editState.type==="Spouse" && editState.row){
    // Update existing row
    const cells = editState.row.querySelectorAll('td');
    cells[0].textContent = name;
    cells[1].textContent = phone;
    cells[2].textContent = email;
    editState.type = null;
    editState.row = null;
    showPopup("Updating Spouse");
  }else{
    spouseCounter++;
    list.insertAdjacentHTML('beforeend',`
      <tr data-type="Spouse" data-id="${spouseCounter}" class="hover:bg-yellow-50">
        <td class="border px-3 py-2">${escapeHtml(name)}</td>
        <td class="border px-3 py-2">${escapeHtml(phone)}</td>
        <td class="border px-3 py-2">${escapeHtml(email)}</td>
        <td class="border px-3 py-2">${actionBtns('Spouse', spouseCounter)}</td>
      </tr>`);
    showPopup("Saving Spouse");
  }

  document.getElementById('spouseForm').reset();
  toggleBlock(spouseFormWrap, spouseToggleBtn);
};

// Children functionality
const childFormWrap = document.getElementById('childFormWrap');
const childToggleBtn = document.getElementById('childToggleBtn');
const childSaveBtn = document.getElementById('childSave');
const childCancelBtn = document.getElementById('childCancel');

childToggleBtn.onclick = () => toggleBlock(childFormWrap, childToggleBtn);

childCancelBtn.onclick = () => {
  document.getElementById('childForm').reset();
  editState.type = null;
  editState.row = null;
  toggleBlock(childFormWrap, childToggleBtn);
};

childSaveBtn.onclick = () => {
  const name = val('childName');
  const sex = val('childSex');
  const dob = val('childDob');
  const phone = val('childPhone');

  if (!name) {
    alert('Full Name is required');
    return;
  }

  const list = document.getElementById('childList');
  const empty = document.getElementById('childEmpty');
  if (empty) empty.remove();

  if(editState.type==="Child" && editState.row){
    // Update existing row
    const cells = editState.row.querySelectorAll('td');
    cells[0].textContent = name;
    cells[1].textContent = sex;
    cells[2].textContent = dob;
    cells[3].textContent = phone;
    editState.type = null;
    editState.row = null;
    showPopup("Updating Child");
  }else{
    childCounter++;
    list.insertAdjacentHTML('beforeend',`
      <tr data-type="Child" data-id="${childCounter}" class="hover:bg-yellow-50">
        <td class="border px-3 py-2">${escapeHtml(name)}</td>
        <td class="border px-3 py-2">${escapeHtml(sex)}</td>
        <td class="border px-3 py-2">${escapeHtml(dob)}</td>
        <td class="border px-3 py-2">${escapeHtml(phone)}</td>
        <td class="border px-3 py-2">${actionBtns('Child', childCounter)}</td>
      </tr>`);
    showPopup("Saving Child");
  }

  document.getElementById('childForm').reset();
  toggleBlock(childFormWrap, childToggleBtn);
};
</script>
