<section class="items border rounded-lg m-6 max-w-lg mr-auto p-6 mx-auto">
  <h2 class="text-2xl text-center border-b font-bold text-blue-600 mb-4">Salary Variance Analysis Audit</h2>

  <!-- Step 1: Select Payment Type -->
  <div id="paymentTypeSection" class="space-y-4 mb-6">
    <label class="block font-medium text-gray-900">Select Payment Type</label>
    <select id="paymentTypeSelect" class="w-full bg-transparent border border-slate-600 rounded-md px-3 py-2 focus:ring-2 focus:ring-blue-500">
      <option value="">-- Payment Type --</option>
      <option value="BP301">BP301</option>
      <option value="BP302">BP302</option>
      <option value="BP303">BP303</option>
      <option value="BP304">BP304</option>
    </select>

    <!-- Action Buttons -->
    <div class="flex gap-3">
      <button id="addPaymentType" class="flex-1 bg-yellow-600 hover:bg-yellow-700 text-white py-2 px-4 rounded-lg transition-colors">
        <i class="fas fa-plus mr-2"></i>Add
      </button>
      <button id="generatePaymentTypes" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
        <i class="fas fa-file-alt mr-2"></i>Generate
      </button>
    </div>
  </div>

  <!-- Step 2: Tabular List of Added Payment Types -->
  <div id="addedPaymentsWrapper" class="hidden mb-6">
    <table class="w-full text-sm border">
      <thead class="bg-gray-100">
        <tr>
          <th class="px-3 py-2 border">Description</th>
          <th class="px-3 py-2 border">Actions</th>
        </tr>
      </thead>
      <tbody id="addedPaymentsTable"></tbody>
    </table>
  </div>

  <!-- Step 3: Hidden Form to Select Month & Year -->
  <div id="monthYearForm" class="hidden space-y-4 border-t border-slate-300 pt-4">
    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-gray-900">Select Month</label>
        <select id="monthSelect" class="w-full border border-slate-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
          <option value="">-- Month --</option>
          <option>January</option><option>February</option><option>March</option>
          <option>April</option><option>May</option><option>June</option>
          <option>July</option><option>August</option><option>September</option>
          <option>October</option><option>November</option><option>December</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-900">Enter Year</label>
        <input type="number" id="yearInput" placeholder="YYYY" class="w-full border border-slate-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500">
      </div>
    </div>

    <div class="flex justify-end gap-3">
      <button id="cancelReport" class=" bg-gray-300 hover:bg-gray-400 py-2 px-4 rounded-lg transition-colors">
        <i class="fas fa-times mr-2"></i>Cancel
      </button>
      <button id="proceedReport" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
        <i class="fas fa-check mr-2"></i>Proceed
      </button>
    </div>
  </div>
</section>

<!-- Reusable Modal -->
<div id="messageModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-md p-6">
    <h3 id="modalTitle" class="text-lg font-semibold mb-4"></h3>
    <p id="modalMessage" class="text-gray-700 mb-6"></p>
    <div class="flex justify-end">
      <button id="modalCloseBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">OK</button>
    </div>
  </div>
</div>

<script>
  const paymentTypeSelect = document.getElementById("paymentTypeSelect");
  const addPaymentTypeBtn = document.getElementById("addPaymentType");
  const generatePaymentTypesBtn = document.getElementById("generatePaymentTypes");
  const addedPaymentsWrapper = document.getElementById("addedPaymentsWrapper");
  const addedPaymentsTable = document.getElementById("addedPaymentsTable");
  const monthYearForm = document.getElementById("monthYearForm");
  const proceedReportBtn = document.getElementById("proceedReport");
  const cancelReportBtn = document.getElementById("cancelReport");

  const messageModal = document.getElementById("messageModal");
  const modalTitle = document.getElementById("modalTitle");
  const modalMessage = document.getElementById("modalMessage");
  const modalCloseBtn = document.getElementById("modalCloseBtn");

  let addedPayments = [];

  // Show modal
  function showModal(title, message) {
    modalTitle.textContent = title;
    modalMessage.textContent = message;
    messageModal.classList.remove("hidden");
  }

  modalCloseBtn.onclick = () => messageModal.classList.add("hidden");

  // Add Payment Type
  addPaymentTypeBtn.onclick = () => {
    const paymentType = paymentTypeSelect.value;
    if (!paymentType) return showModal("Error", "Please select a payment type to add!");
    if (addedPayments.includes(paymentType)) return showModal("Error", "Payment type already added!");

    addedPayments.push(paymentType);
    showModal("Success", `${paymentType} added successfully`);
    paymentTypeSelect.value = "";
  };

  // Generate table of added payment types
  generatePaymentTypesBtn.onclick = () => {
    if (addedPayments.length === 0) return showModal("Error", "No payment types added!");

    addedPaymentsWrapper.classList.remove("hidden");
    monthYearForm.classList.remove("hidden");

    addedPaymentsTable.innerHTML = "";
    addedPayments.forEach(pt => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="px-3 py-2 border">${pt}</td>
        <td class="px-3 py-2 border text-center">
          <button class="bg-red-600 text-white px-2 py-1 rounded deleteBtn">Delete</button>
        </td>`;
      addedPaymentsTable.appendChild(row);

      // Delete functionality
      row.querySelector(".deleteBtn").onclick = () => {
        addedPayments = addedPayments.filter(p => p !== pt);
        row.remove();
        if (addedPayments.length === 0) {
          addedPaymentsWrapper.classList.add("hidden");
          monthYearForm.classList.add("hidden");
        }
      };
    });
  };

  // Proceed
  proceedReportBtn.onclick = () => {
    const month = document.getElementById("monthSelect").value;
    const year = document.getElementById("yearInput").value;
    if (!month || !year) return showModal("Error", "Select month and year!");

    showModal("Success", `Generating Salary Variance Report for ${month} ${year} for payment types: ${addedPayments.join(", ")}`);
    // Here you would call your backend API to generate the report
  };

  // Cancel
  cancelReportBtn.onclick = () => {
    addedPayments = [];
    addedPaymentsWrapper.classList.add("hidden");
    monthYearForm.classList.add("hidden");
    addedPaymentsTable.innerHTML = "";
  };
</script>
